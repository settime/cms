if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.Histogram={TopLabelColor:null}}LChart.Histogram=LChart.getCore().__extends({GraphType:"Histogram"});LChart.Histogram._spreadSkin=function(b,a){b.topLabel={};b.topLabel.color=a.TopLabelColor||null};LChart.Histogram._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{animateY:true,animateX:true,histogram:{colors:null,length:null,gap:null,useSameColor:true},topLabel:{show:true,content:function(c){if(this.valueType=="d"||this.valueType=="t"||this.valueType=="m"){return""}else{if(this.valueType=="p"){return c.percent.toFixed(1).toString()+"%"}else{return c.value.toString()}}},color:null,fontweight:null,fontsize:null,fontfamily:null}});return a};LChart.Histogram._getCheckOptions=function(){return{__top:[["animateY","b"],["animateX","b"]],histogram:[["colors","ca"],["length","n"],["gap","n"],["useSameColor","b"]],topLabel:[["show","b"],["content","f"],["color","c"],["fontweight","s"],["fontsize","n"],["fontfamily","s"]]}};LChart.Histogram._drawgraphic=function(x,k,p,e){if(k==x.ID){x._configs.notAllowValueNegative=true}var g=x._formatAxisData();var b=x._calculateOutersValid();var u=x._computeAxis(b);var t=x._getDrawableCoordinate();x.shapes[k]={histograms:[]};if(!x.coordinates.histograms){x.coordinates.histograms={}}x.coordinates.histograms[k]=[];var z=x._configs.specificConfig[k];var a=g.vValueType=="p";var c=e.shadow.show&&e.shadow.blur>0;var h=c?e.shadow:null;if(h){if(h.blur&&h.offsetY>-h.blur){h.offsetY=-h.blur}}var f=e.histogram.length;var n=e.histogram.gap;if(g.multiple){if(n&&n>0){var y=(u.labelDistance-g.demanCount*2)/(g.demanCount+1);n=Math.min(n,y)}else{n=u.labelDistance/20}}else{n=0}if(f&&f>0){var d=g.multiple?((u.labelDistance-(g.demanCount+1)*n)/g.demanCount):u.labelDistance*0.8;f=Math.min(f,d)}else{f=(u.labelDistance-(g.demanCount+1)*n)/(g.multiple?(g.demanCount+0.5):1.5)}var w=function(B,A){if(A!=undefined){var C=g.demanCount/2-B;return u.startPos+u.labelDistance*A-C*f-(C-0.5)*n}else{return u.startPos+u.labelDistance*B-f/2}};var j=(e.histogram.colors&&e.histogram.colors.length>0?e.histogram.colors:null)||LChart.Const.Defaults.FillColors;if(k==x.ID){x.coordinates.draw=t;x._configs.legendColors=j;if(g.multiple){x._configs.pointsPosition={labelDistance:u.labelDistance,startPoints:[]};for(var s=0,v;v=p[s];s++){x._configs.pointsPosition[s]=w(s,0)+f/2}}}var r=function(B,I,i,J,E,G,D){x.DrawFigures.createRectangleFill(B,I,i,J,E,D||h);if(G&&e.topLabel.show){var A=e.topLabel;var H=typeof A.content=="function"?A.content.call(e,G):"";if(H){var F=B+i/2;var K=A.fontsize||LChart.Methods.CapValue(i/2,18,11);var C=I-K/2;x.DrawFigures.createText(H,F,C,"center",G.fontweight||A.fontweight,G.fontsize||K,A.fontfamily,G.fontcolor||A.color)}}};var m=function(C,B,G,F,D,i,A,E){this.indexX=C;this.indexY=B;this.left=G;this.top=F;this.width=D;this.height=i;this.data=E;this.isHovered=false;this.color=A;this.redraw=function(H,I){if(arguments.length==1&&typeof arguments[0]=="boolean"){I=arguments[0];H=undefined}var J=h;if(h&&h.show&&H){J=LChart.Methods.DeepCopy(h);J.color=H}r(this.left,this.top,this.width,this.height,H||this.color,I?this.data:null,J)};this.click=function(I){var H=typeof this.data.click=="function"?this.data.click:(e.click||null);if(H){H(this.data,I)}};if(e.tip.show&&typeof e.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var J=this.left+this.width/2+5;var I=this.top+this.height/2;this.tip=x._createTip(e.tip.content.call(e,this.data),J,I);if(J+this.tip.clientWidth>u.maxX){x._changeTip(this.tip,J-this.tip.clientWidth)}var H=this;H.tip.onclick=function(K){H.click(K)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var o=function(A,F){var I=function(O){var i=(e.animateY?A:1)*(u.maxY-u.minY)*x._getFormatDiff(g.vValueType,g.vMinValue,O)/x._getFormatDiff(g.vValueType,g.vMinValue,g.vMaxValue);return i};for(var H=0,N;N=p[H];H++){var B=(e.animateX?A:1)*f;if(g.multiple){var E=N.color||j[H%j.length];var L=a?N.percent:N.value;for(var D=0;D<L.length;D++){if(N.value[D]!=null){var C=w(H,D);var M=I(L[D]);var K=u.maxY-M;if(F>=1){var G={click:N.click,mouseover:N.mouseover,mouseleave:N.mouseleave,text:N.text,label:g.lLabels[D],indexX:D,indexY:H,fontsize:N.fontsize,fontcolor:N.fontcolor,fontweight:N.fontweight};if(a){G.percent=L[D];G.value=N.value[D]}else{G.value=L[D]}var J=new m(D,H,C,K,B,M,E,G);x.shapes[k].histograms.push(J);r(C,K,B,M,E,G);if(!x.coordinates.histograms[k][D]){x.coordinates.histograms[k][D]=[]}x.coordinates.histograms[k][D][H]={left:C,top:K,width:B,height:M,color:E}}else{r(C,K,B,M,E)}}}}else{if(N.value!=null){var C=w(H);var M=I(a?N.percent:N.value);var K=u.maxY-M;var E=N.color||(e.histogram.useSameColor?"rgba(69,114,167,1)":j[H%j.length]);if(F>=1){N.indexX=H;N.indexY=null;var J=new m(H,null,C,K,B,M,E,N);x.shapes[k].histograms.push(J);
r(C,K,B,M,E,N);x.coordinates.histograms[k][H]={left:C,top:K,width:B,height:M,color:E}}else{r(C,K,B,M,E)}}}}};var l=function(){var B=function(C,G){var F=null;for(var E=0,D;D=x.shapes[k].histograms[E];E++){if(D.left<=C&&D.left+D.width>=C&&D.top<=G&&D.top+D.height>=G){F=D;break}}return F};var A=function(E){var E=window.event||E;var C=x._getMouseLoction(E);var D=B(C.X,C.Y);if(D){D.click(E)}};var i=function(J){var J=window.event||J;var E=x._getMouseLoction(J);var I=B(E.X,E.Y);if(I){x._configs.cursorPointer=true}if(z.currentMouseShape!=I){var F=z.currentMouseShape;if(F){var C=typeof F.data.mouseleave=="function"?F.data.mouseleave:(e.mouseleave||null);if(C){C(F.data,J)}}if(c||z.currentMouseShape){x.redrawAll()}z.currentMouseShape=I;for(var H=0,F;F=x.shapes[k].histograms[H];H++){if(F!=I&&F.isHovered){F.isHovered=false;if(F.hideTip){F.hideTip()}}}if(I){I.isHovered=true;var G=e.mouseoverTransparency;I.redraw("rgba(255,255,255,"+(G>0&&G<1?G:0.2)+")");if(I.showTip){I.showTip()}var D=typeof I.data.mouseover=="function"?I.data.mouseover:(e.mouseover||null);if(D){D(I.data,J)}}}};x._addEventListener("click",A);x._addEventListener("mousemove",i)};var q=function(){for(var B=0,A;A=x.shapes[k].histograms[B];B++){A.redraw(true)}};return{drawSegments:o,mouseEvents:l,redraw:q}};