if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.MultiRing={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:"rgba(255,255,255,0.3)"}}LChart.MultiRing=LChart.getCore().__extends({GraphType:"MultiRing"});LChart.MultiRing._spreadSkin=function(b,a){b.separateLine={};b.innerLabel={};b.outerLabel={};b.separateLine.color=a.SeparateLineColor||null;b.innerLabel.color=a.InnerLabelColor||null;b.outerLabel.color=a.OuterLabelColor||null;b.outerLabel.bordercolor=a.OuterLabelBorderColor||null;b.outerLabel.backcolor=a.OuterLabelBackColor||null};LChart.MultiRing._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{offX:0,offY:0,radius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,lengths:null,labels:null,separateLine:{color:null,width:null},innerLabel:{show:true,content:function(c){return c.percent.toFixed(1)+"%"},color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(c){return c.text},withlegend:true,legendtype:null,length:null,color:null,backcolor:"rgba(255,255,255,0.3)",bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null},tip:{content:function(c){return"<div>"+(c.label?c.label+"<br/>":"&nbsp;")+c.text+"<br/>value："+c.value.toString()+"<br/>percent："+c.percent.toFixed(1)+"%</div>"}}});return a};LChart.MultiRing._getCheckOptions=function(){return{__top:[["offX","n"],["offY","n"],["radius","n"],["margin","n"],["colors","ca"],["animateRotate","b"],["animateScale","b"],["startAngle","n"],["lengths","na"],["labels","sa"]],separateLine:[["color","c"],["width","n"]],innerLabel:[["show","b"],["content","f"],["color","c"],["fontsize","n"],["fontfamily","s"]],outerLabel:[["show","b"],["content","f"],["withlegend","b"],["legendtype","s"],["length","n"],["backcolor","c"],["bordercolor","c"],["borderwidth","n"],["color","c"],["fontsize","n"],["fontfamily","s"]]}};LChart.MultiRing._drawgraphic=function(D,n,y,d){var v=D._computeSegmentTotal(y).segmentTotals;var B=D._computeRadiusForPies(d);var j=y[0].value.length;var c=y.length;if(!j||j<1){throw new Error(D._messages.WrongData+D._messages.DataMustBeMultipleArray)}var w=d.separateLine.width||1;var g=!d.radius||!LChart.Methods.IsNumber(d.radius)?B.maxRadius:d.radius;var o=(d.colors&&d.colors.length>0?d.colors:null)||LChart.Const.Defaults.FillColors;var C=d.labels&&d.labels.length>0?d.labels:[""];var e=d.lengths&&d.lengths.length>0?d.lengths:null;var l=n==D.ID;if(l){D.coordinates.draw=B.coordinate;D._configs.legendColors=o}if(!D.coordinates.multiRing){D.coordinates.multiRing={}}D.coordinates.multiRing[n]={radius:g,centerX:B.centerX,centerY:B.centerY,cemicircles:[],outerlabels:[]};if(e){var p=0;for(var x=0;x<j;x++){var f=e[x%e.length];p+=f}if(p>g){throw new Error(D._messages.WrongSet+D._messages.SumOfLengthsMustBeLessThanRadius)}}D.shapes[n]={cemicircles:[],outerLabels:[]};var s=D.shapes[n];var b=3;var a=3;var m=true;var E=D._configs.specificConfig[n];var r=function(F,k,J,I,H,G){this.index=F;this.angleMin=k;this.angleMax=J;this.innerRadius=I;this.outerRadius=H;this.data=G;this.isHovered=false;this.color=function(){return this.data.color||o[this.index%o.length]};this.redraw=function(K){A(1,this.innerRadius,this.outerRadius,this.angleMin,this.angleMax,K||this.color())};this.click=function(L){var K=typeof this.data.click=="function"?this.data.click:(d.click||null);if(K){K(this.data,L)}};if(d.tip.show&&typeof d.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var N=(this.angleMin+this.angleMax)/2;var M=B.centerX+(this.outerRadius+this.innerRadius)/2*Math.cos(N);var L=B.centerY+(this.outerRadius+this.innerRadius)/2*Math.sin(N);this.tip=D._createTip(d.tip.content(this.data),M,L);var K=this;K.tip.onclick=function(O){K.click(O)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var h=function(K,J,I,G,F,H,L,k){this.content=K;this.length=J;this.width=I;this.height=G;this.floatright=F;this.floattop=H;this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2};this.data=L;this.contact=k;this.color=function(){return this.contact.color()};this.index=function(){return this.contact.index};this.resetposition=function(){var N=this.length;var S=B.centerX;var P=B.centerY;var R=(this.contact.angleMin+this.contact.angleMax)/2;var O=Math.cos(R);var M=Math.sin(R);var T=1.15;var Q=M>0?M:0;this.startX=S+g*O;this.startY=P+g*M;this.left=S+g*T*O+(this.floatright?0:-this.width);this.top=P+g*T*M+Q*N-N-a}};var A=function(aa,L,V,G,I,X,Q,Z,S){var O=(G+I)/2;var N=B.centerX;var M=B.centerY;var T=Math.cos(O);var K=Math.sin(O);D.DrawFigures.createRing(N,M,L*aa,V*aa,X,G,I,w,d.separateLine.color);if(Q){var F=d.outerLabel;if(!(Z&&F.show&&typeof F.content=="function")){return}var J=F.length||g/12;
var P=LChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,O);var Y=LChart.Methods.JudgeBetweenAngle(-Math.PI,0,O);var W=F.content(Z);var H=D.DrawFigures.measureText(W,null,F.fontsize||(J-1),F.fontfamily);var U=H+(F.withlegend?J+3*b:2*b);var R=J+a*2;var k=new h(W,J,U,R,P?1:0,Y?1:0,Z,S);s.outerLabels.push(k);S.contact=k}};var i=function(I){var H=d.innerLabel;if(!(H.show&&typeof H.content=="function")){return}var G=function(J){var O=(J.angleMin+J.angleMax)/2;var L=J.data;var K=(J.innerRadius+J.outerRadius)/2;var N=B.centerX+K*Math.cos(O);var M=B.centerY+K*Math.sin(O);D.DrawFigures.createText(H.content(L),N,M,"center",L.fontweight,L.fontsize||H.fontsize||LChart.Methods.CapValue((J.outerRadius-J.innerRadius)/3,15,11),H.fontfamily,L.fontcolor||H.color||LChart.Const.Defaults.InnerLabelColor)};if(I){G(I)}else{for(var F=0,k;k=s.cemicircles[F];F++){G(k)}}};var u=function(L,I){var F=d.outerLabel;if(!(F.show&&typeof F.content=="function")){return}var G=l?B.coordinate.minY:5;var k=l?B.coordinate.maxY:D.canvas.height-5;if(m){for(var H=0,K;K=s.outerLabels[H];H++){K.resetposition()}m=false}var J=function(){var T=function(Y,X){return Math.max(Y.left,X.left)<=Math.min(Y.left+Y.width,X.left+X.width)&&Math.max(Y.top,X.top)<=Math.min(Y.top+Y.height,X.top+X.height)};var P=[];var N=[];var U=[];var O=[];for(var S=0,W;W=s.outerLabels[S];S++){while(G>W.top){W.top+=a;W.left+=W.floatright?b:-b}while(k<W.top+W.height){W.top-=a;W.left+=W.floatright?b:-b}if(W.floatright&&W.floattop){U.push(W)}else{if(W.floatright&&!W.floattop){O.push(W)}else{if(!W.floatright&&W.floattop){P.push(W)}else{N.push(W)}}}}var V=0;var R=[];var Q=function(Y){if(R.length>0){for(var X=0,Z;Z=R[X];X++){while(T(Z,Y)&&V<1000){Y.top+=Y.floattop?a:-a;Y.left+=Y.floatright?b:-b;V++}}}R.push(Y)};for(var S=P.length-1;S>=0;S--){Q(P[S])}R=[];for(var S=0;S<N.length;S++){Q(N[S])}R=[];for(var S=0;S<U.length;S++){Q(U[S])}R=[];for(var S=O.length-1;S>=0;S--){Q(O[S])}};var M=function(P,O){var N=P;if(!O){D.DrawFigures.createQuadraticCurve(N.startX,N.startY,N.startX*0.8+N.endX()*0.2,N.startY*0.2+N.endY()*0.8,N.endX(),N.endY(),1,F.bordercolor);if(F.backcolor){D.DrawFigures.createRectangleFill(N.left,N.top,N.width,N.height,F.backcolor)}var T=F.fontsize||(N.length-1);var S=N.left+(N.floatright?b+(F.withlegend?N.length+b:0):N.width-b);var R=N.top+N.length/2+T/2+a/2;D.DrawFigures.createText(N.content,S,R,N.floatright?"left":"right",null,T,F.fontfamily,F.color);if(F.borderwidth&&F.borderwidth>0){D.DrawFigures.createRectangleBorder(N.left,N.top,N.width,N.height,F.borderwidth,F.bordercolor)}}if(F.withlegend){var Q=F.legendtype||"s";var O=O||N.color();D.DrawFigures.createPointElement(Q,N.left+b,N.top+a,N.length,O,Q!="x",O,2,Q=="x")}};if(L){M(L.contact,I)}else{J();D.coordinates.multiRing[n].outerlabels.length=0;for(var H=0,K;K=s.outerLabels[H];H++){M(K);D.coordinates.multiRing[n].outerlabels[H]={index:K.contact.index,left:K.left,top:K.top,width:K.width,height:K.height}}}};var t=function(O,Y){var M=Math.PI*(d.startAngle==null?-0.5:d.startAngle);var P=d.animation&&d.animateScale?O:1;var R=d.animation&&d.animateRotate?O:1;var X=g;for(var U=0;U<j;U++){var J=e?e[U%e.length]:g/(j<=2?2*j:2*j-1);var N=C[U%C.length];var S=X;X-=J;var L=X;var V=M;for(var W=0,Z;Z=y[W];W++){var Q=Z.value[U];var F=(Q/v[U])*100;var aa=R*(F/100*(Math.PI*2));var T=Z.color||o[W%o.length];var H=V;var I=V+D._formatSegmentAngle(aa);if(Y>=1){var K=W+c*U;var ab={index:K,color:T,percent:F,value:Q,text:Z.text,label:N,click:Z.click,mouseover:Z.mouseover,mouseleave:Z.mouseleave,fontsize:Z.fontsize,fontcolor:Z.fontcolor,fontweight:Z.fontweight};var G=new r(K,H,I,L,S,ab);A(P,L,S,H,I,T,U==0,ab,G);s.cemicircles.push(G);D.coordinates.multiRing[n].cemicircles.push({index:K,percent:F,angleMin:H,angleMax:I,innerRadius:L,outerRadius:S})}else{A(P,L,S,H,I,T)}V=I}}if(Y>=1){i();u()}};var z=function(){for(var F=0,k;k=s.cemicircles[F];F++){k.redraw()}i();u()};var q=function(){var H=function(J){J.isHovered=true;var K=d.mouseoverTransparency;J.redraw("rgba(255,255,255,"+(K>0&&K<1?K:0.2)+")");if(J.showTip){J.showTip()}};var G=function(J,Q){var M=null;for(var L=0,K;K=s.cemicircles[L];L++){var O=(K.angleMin+K.angleMax)/2;var N=LChart.Methods.GetCurrentAngle(J,Q,B.centerX,B.centerY);var P=Math.pow(J-B.centerX,2)+Math.pow(Q-B.centerY,2);if(P<=Math.pow(K.outerRadius+w,2)&&P>=Math.pow(K.innerRadius-w,2)&&LChart.Methods.JudgeBetweenAngle(K.angleMin,K.angleMax,N)){M=K;break}}return M};var I=function(J,N){var K=null;for(var M=0,L;L=s.outerLabels[M];M++){if(J>=L.left&&J<=L.left+L.width&&N>=L.top&&N<=L.top+L.height){K=L.data.index;break}}return K};var F=function(L){var L=window.event||L;var J=D._getMouseLoction(L);var K=G(J.X,J.Y);if(K){K.click(L)}};var k=function(P){var P=window.event||P;var L=D._getMouseLoction(P);var O=G(L.X,L.Y)||I(L.X,L.Y);if(O){D._configs.cursorPointer=true}if(E.currentMouseTarget!=O){var M=E.currentMouseTarget;if(M&&M.data){var J=typeof M.data.mouseleave=="function"?M.data.mouseleave:(d.mouseleave||null);if(J){J(M.data,P)}}if(E.currentMouseTarget!=null){D.redrawAll()
}E.currentMouseTarget=O;for(var N=0,M;M=s.cemicircles[N];N++){if(M.isHovered){M.isHovered=false;if(M.hideTip){M.hideTip()}}}if(O!=null){if(O.data){H(O);var K=typeof O.data.mouseover=="function"?O.data.mouseover:(d.mouseover||null);if(K){K(O.data,P)}}else{for(var N=0,M;M=s.cemicircles[N];N++){if(M.index%c==O){H(M)}}}}}};D._addEventListener("click",F);D._addEventListener("mousemove",k)};return{drawSegments:t,mouseEvents:q,redraw:z}};