if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.HeapHistogram3D={CutLinecolor:null,InnerLabelColor:null}}LChart.HeapHistogram3D=LChart.getCore().__extends({GraphType:"HeapHistogram3D"});LChart.HeapHistogram3D._spreadSkin=function(b,a){b.histogram={};b.label={};b.histogram.cutlinecolor=a.CutLinecolor||null;b.label.color=a.InnerLabelColor||null};LChart.HeapHistogram3D._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{animateY:true,animateX:true,histogram:{colors:null,length:null,cutlinecolor:null,cutlinewidth:null},label:{show:true,content:function(c){return this.valueType=="p"?c.percent.toFixed(1)+"%":c.value.toString()},color:null,fontweight:null,fontsize:null,fontfamily:null}});return a};LChart.HeapHistogram3D._getCheckOptions=function(){return{__top:[["animateY","b"],["animateX","b"]],histogram:[["colors","ca"],["length","n"],["cutlinecolor","c"],["cutlinewidth","n"]],label:[["show","b"],["content","f"],["color","c"],["fontweight","s"],["fontsize","n"],["fontfamily","s"]]}};LChart.HeapHistogram3D._drawgraphic=function(s,i,n,e){if(e.valueType&&e.valueType!="n"&&e.valueType!="p"){throw new Error(s._messages.WrongParam+s._messages.ValueTypeMustBeNumberOrPercent)}if(!LChart.Methods.IsArray(n[0].value)){throw new Error(s._messages.WrongData+s._messages.DataMustBeMultipleArray)}s._configs.recreateAssists=true;if(i==s.ID){s._configs.notAllowValueNegative=true}var g=s._formatAxisData(true);var b=s._calculateOutersValid();var r=s._computeAxis(b);var q=s._getDrawableCoordinate();var c=Math.floor(e.histogram.cutlinewidth||0);var h=e.histogram.cutlinecolor||"#ffffff";var a=g.vValueType=="p";var f=e.histogram.length;if(f&&f>0){var d=r.labelDistance*0.8;f=Math.min(f,d)}else{f=r.labelDistance*0.6}var j=(e.histogram.colors&&e.histogram.colors.length>0?e.histogram.colors:null)||LChart.Const.Defaults.FillColors;if(i==s.ID){s.coordinates.draw=q;s._configs.legendColors=j}var t=s._configs.specificConfig[i];s.shapes[i]={histograms:[]};if(!s.coordinates.histograms){s.coordinates.histograms={}}s.coordinates.histograms[i]=[];var p=function(E,z,C,u,x,w){var I=E.left-r.stagewidth*r.sinsightangle;var G=E.top+r.stagewidth*r.cossightangle;var B=z||E.color;if(u){s.DrawFigures.create3DHistogram(I,G,E.width,E.height,B,0,r.sightangle,r.stagewidth,null,C?z:E.topcolor||LChart.Methods.getDarkenColor(B,0.7),C?z:E.rightcolor||LChart.Methods.getDarkenColor(B,0.8))}if(w&&e.label.show){var v=e.label;var D=typeof v.content=="function"?v.content.call(e,E.data):"";if(D){var A=I+E.width/2;var H=v.fontsize||LChart.Methods.CapValue(E.width/2,18,11);var y=G+E.height/2+H/3;s.DrawFigures.createText(D,A,y,"center",E.data.fontweight||v.fontweight,E.data.fontsize||H,v.fontfamily,E.data.fontcolor||v.color)}}if(x&&E.linetop){var F=E.linetop+r.stagewidth*r.cossightangle;if(c>1){s.DrawFigures.create3DHistogram(I,F,E.width,c,h,0,r.sightangle,r.stagewidth,null,h,h)}else{s.DrawFigures.createLine(I,F,I+E.width,F,c,h);s.DrawFigures.createLine(I+E.width,F,E.left+E.width,E.top,c,h)}}};var l=function(E,C,x,B,v,D,y,u,w,z,A){this.indexX=E;this.indexY=C;this.left=x;this.top=B;this.width=v;this.height=D;this.data=z;this.linetop=A;this.isHovered=false;this.color=y;this.topcolor=u;this.rightcolor=w;this.redraw=function(F){p(this,F,true,true)};this.click=function(G){var F=typeof this.data.click=="function"?this.data.click:(e.click||null);if(F){F(this.data,G)}};if(e.tip.show&&typeof e.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var H=this.left;var G=this.top+this.height/2;this.tip=s._createTip(e.tip.content.call(e,this.data),H,G);if(H+this.tip.clientWidth>r.maxX){s._changeTip(this.tip,H-this.tip.clientWidth-this.width)}var F=this;F.tip.onclick=function(I){F.click(I)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var m=function(y,J){var z=function(P){var O=(e.animateY?y:1)*(r.maxY-r.minY)*s._getFormatDiff(g.vValueType,g.vMinValue,P)/s._getFormatDiff(g.vValueType,g.vMinValue,g.vMaxValue);return O};var A=J>=1;var M=[];var E=(e.animateX?y:1)*f;for(var H=0;H<g.tuftCount;H++){var x=r.startPos+r.labelDistance*H-f/2;var D=0;var w=[];for(var F=0;F<g.demanCount;F++){var K=n[F];var G=K.color||j[F%j.length];var v=a?K.percent:K.value;var N=v[H];if(N!=null){var C=z(N);D+=C;var B=r.maxY-D;if(B<r.minY+1){C-=r.minY+1-B;B=r.minY+1}if(F>0){C-=c/2}if(C+B>r.maxY){C=r.maxY-B}var I=null;if(c>0&&F<g.demanCount-1){I=B-c/2;if(I+c/2+1>r.maxY){I=r.maxY-c/2-1}}var L=null;if(A){L={click:K.click,mouseover:K.mouseover,mouseleave:K.mouseleave,label:g.lLabels[H],text:K.text,indexX:H,indexY:F,fontsize:K.fontsize,fontcolor:K.fontcolor,fontweight:K.fontweight};if(a){L.percent=N;L.value=K.value[H]}else{L.value=N}if(!s.coordinates.histograms[i][H]){s.coordinates.histograms[i][H]=[]}s.coordinates.histograms[i][H][F]={left:x,top:B,width:E,height:C,color:G}
}var u=new l(H,F,x,B,E,C,G,K.topcolor,K.rightcolor,L,I);M.push(u)}}}M.sort(function(P,O){if(P.indexX==O.indexX){return P.indexY-O.indexY}else{return P.indexX-O.indexX}});for(var H=0,u;u=M[H];H++){p(u,u.color,false,true,c>1)}if(c>0&&c<=1){for(var H=0,u;u=M[H];H++){p(u,u.color,false,false,true)}}if(A){for(var H=0,u;u=M[H];H++){p(u,u.color,false,false,false,true)}s.shapes[i].histograms=M}};var k=function(){var w=function(H,G){var A=null;var C=r.cossightangle*r.stagewidth;var z=r.sinsightangle*r.stagewidth;for(var B=0,D;D=s.shapes[i].histograms[B];B++){var J=D.left-r.stagewidth*r.sinsightangle;var I=D.top+r.stagewidth*r.cossightangle;if(J<=H&&J+D.width>=H&&I<=G&&I+D.height>=G){A=D;break}}if(!A){for(var B=0,D;D=s.shapes[i].histograms[B];B++){if(D.left+D.width-z<=H&&D.left+D.width>=H){var E=D.top+C*(D.left+D.width-H)/z;if(E<=G&&E+D.height>=G){A=D;break}}}}if(!A){for(var B=0,D;D=s.shapes[i].histograms[B];B++){if(D.top<=G&&D.top+C>=G){var F=D.left-z*(G-D.top)/C;if(F<=H&&F+D.width>=H){A=D;break}}}}return A};var v=function(z){var z=window.event||z;var x=s._getMouseLoction(z);var y=w(x.X,x.Y);if(y){y.click(z)}};var u=function(D){var D=window.event||D;var z=s._getMouseLoction(D);var C=w(z.X,z.Y);if(C){s._configs.cursorPointer=true}if(t.currentMouseShape!=C){var A=t.currentMouseShape;if(A){A.isHovered=false;if(A.hideTip){A.hideTip()}var x=typeof A.data.mouseleave=="function"?A.data.mouseleave:(e.mouseleave||null);if(x){x(A.data,D)}}if(t.currentMouseShape){s.redrawAll()}t.currentMouseShape=C;if(C){C.isHovered=true;var B=e.mouseoverTransparency;C.redraw("rgba(255,255,255,"+(B>0&&B<1?B:0.2)+")");if(C.showTip){C.showTip()}var y=typeof C.data.mouseover=="function"?C.data.mouseover:(e.mouseover||null);if(y){y(C.data,D)}}}};s._addEventListener("click",v);s._addEventListener("mousemove",u)};var o=function(){for(var v=0,u;u=s.shapes[i].histograms[v];v++){p(u,u.color,false,true,c>1)}if(c>0&&c<=1){for(var v=0,u;u=s.shapes[i].histograms[v];v++){p(u,u.color,false,false,true)}}for(var v=0,u;u=s.shapes[i].histograms[v];v++){p(u,u.color,false,false,false,true)}};return{drawSegments:m,mouseEvents:k,redraw:o}};