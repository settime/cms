if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.MultiRing3D={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:"rgba(255,255,255,0.3)"}}LChart.MultiRing3D=LChart.getCore().__extends({GraphType:"MultiRing3D"});LChart.MultiRing3D._spreadSkin=function(b,a){b.separateLine={};b.innerLabel={};b.outerLabel={};b.separateLine.color=a.SeparateLineColor||null;b.innerLabel.color=a.InnerLabelColor||null;b.outerLabel.color=a.OuterLabelColor||null;b.outerLabel.bordercolor=a.OuterLabelBorderColor||null;b.outerLabel.backcolor=a.OuterLabelBackColor||null};LChart.MultiRing3D._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{offX:0,offY:0,radius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,lengths:null,labels:null,reflection3d:{reflectoffX:null,reflectoffY:null,zoomX:null,zoomY:null},separateLine:{color:null,width:null},innerLabel:{show:true,content:function(c){return c.percent.toFixed(1)+"%"},color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(c){return c.text},withlegend:true,legendtype:null,length:null,color:null,backcolor:"rgba(255,255,255,0.3)",bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null},tip:{content:function(c){return"<div>"+(c.label?c.label+"<br/>":"&nbsp;")+c.text+"<br/>value："+c.value.toString()+"<br/>percent："+c.percent.toFixed(1)+"%</div>"}}});return a};LChart.MultiRing3D._getCheckOptions=function(){return{__top:[["offX","n"],["offY","n"],["radius","n"],["margin","n"],["colors","ca"],["animateRotate","b"],["animateScale","b"],["startAngle","n"],["lengths","na"],["labels","sa"]],reflection3d:[["reflectoffX","n"],["reflectoffY","n"],["zoomX","n"],["zoomY","n"]],separateLine:[["color","c"],["width","n"]],innerLabel:[["show","b"],["content","f"],["color","c"],["fontsize","n"],["fontfamily","s"]],outerLabel:[["show","b"],["content","f"],["withlegend","b"],["legendtype","s"],["length","n"],["backcolor","c"],["bordercolor","c"],["borderwidth","n"],["color","c"],["fontsize","n"],["fontfamily","s"]]}};LChart.MultiRing3D._drawgraphic=function(p,o,j,n){var m=p._computeSegmentTotal(j).segmentTotals;var i=3;var h=3;var H=n.reflection3d.zoomX||1.2;var G=n.reflection3d.zoomY||0.9;if(p._configs._isIE678.isIE678){H=1;G=1}var z=p._computeRadiusForPies(n,H,G);if(p._configs._isIE678.isIE678){z.maxRadius*=0.9}var D=j[0].value.length;var r=j.length;if(!D||D<1){throw new Error(p._messages.WrongData+p._messages.DataMustBeMultipleArray)}var C=!n.radius||!LChart.Methods.IsNumber(n.radius)?z.maxRadius:n.radius;var B=(n.colors&&n.colors.length>0?n.colors:null)||LChart.Const.Defaults.FillColors;var g=n.labels&&n.labels.length>0?n.labels:[""];var a=n.lengths&&n.lengths.length>0?n.lengths:null;var w=o==p.ID;if(w){p.coordinates.draw=z.coordinate;p._configs.legendColors=B}if(!p.coordinates.multiRing){p.coordinates.multiRing={}}p.coordinates.multiRing[o]={radius:C,centerX:z.centerX,centerY:z.centerY,cemicircles:[],outerlabels:[]};if(a){var I=0;for(var K=0;K<D;K++){var l=a[K%a.length];I+=l}if(I>C){throw new Error(p._messages.WrongSet+p._messages.SumOfLengthsMustBeLessThanRadius)}}p.shapes[o]={cemicircles:[],outerLabels:[],faces:null};var t=p.shapes[o];var F=n.reflection3d.reflectoffX||0;var E=n.reflection3d.reflectoffY||C/6;var e=true;var u=n.separateLine.width||1;var d=n.separateLine.color||"#ffffff";var J=Math.PI*(n.startAngle==null?-0.5:n.startAngle);var N=p._configs.specificConfig[o];var L=p._getReflectAngle(F,E);var c=function(U,R,S,Y){var k=(S+Y)/2;var Q=z.centerX;var P=z.centerY;var T=Math.cos(k);var O=Math.sin(k);var W=Q+F;var V=P+E;var X=function(ac,aa,ad){var Z=ac==0?Q:(ac==1?P:(ac==2?W:V));var ab=ac==0||ac==2?Math.cos:Math.sin;return Z+ab(aa?Y:S)*(ad?R:U)};return{angleMin:S,angleMax:Y,midAngle:k,centerX:Q,centerY:P,darkCenterX:W,darkCenterY:V,innerRadius:U,outerRadius:R,iStartX:X(0,0,0),iStartY:X(1,0,0),iEndX:X(0,1,0),iEndY:X(1,1,0),oStartX:X(0,0,1),oStartY:X(1,0,1),oEndX:X(0,1,1),oEndY:X(1,1,1),d_iStartX:X(2,0,0),d_iStartY:X(3,0,0),d_iEndX:X(2,1,0),d_iEndY:X(3,1,0),d_oStartX:X(2,0,1),d_oStartY:X(3,0,1),d_oEndX:X(2,1,1),d_oEndY:X(3,1,1)}};var q=function(X,W,O,U,T,Q,S,R,V,k,P){this.indexX=X;this.indexY=W;this.color=O;this.darksidecolor=U;this.innerRadius=T;this.outerRadius=Q;this.percent=S;this.angleMin=R;this.angleMax=V;this.midAngle=k;this.isHovered=false;this.data=P;this.redraw=function(Y){var aa=Y;for(var Z=0;Z<4;Z++){A(this.indexX,Z,Y||this.color,this.innerRadius,this.outerRadius,this.angleMin,this.angleMax,aa?Y:this.darksidecolor,aa)}};this.contact=null;this.computeinfo=function(Y){if(!this._computeinfo||Y){this._computeinfo=c(this.innerRadius,this.outerRadius,this.angleMin,this.angleMax)}return this._computeinfo};this.click=function(Z){var Y=typeof this.data.click=="function"?this.data.click:(n.click||null);if(Y){Y(this.data,Z)
}};if(n.tip.show&&typeof n.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var ab=(this.angleMin+this.angleMax)/2;var aa=z.centerX+(this.outerRadius+this.innerRadius)/2*Math.cos(ab);var Z=z.centerY+(this.outerRadius+this.innerRadius)/2*Math.sin(ab);this.tip=p._createTip(n.tip.content(this.data),aa*H,Z*G);var Y=this;Y.tip.onclick=function(ac){Y.click(ac)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var y=function(k){return LChart.Methods.computeDifferAngle(k,L*Math.PI)<Math.PI/2};var v=function(T,S,R,P,O,Q,U,k){this.content=T;this.length=S;this.width=R;this.height=P;this.floatright=O;this.floattop=Q;this.data=U;this.contact=k;this.color=this.contact.color;this.index=this.contact.indexY;this.resetposition=function(){var W=this.contact.computeinfo(),V=y(W.midAngle);var aa=1.15,Y=Math.cos(W.midAngle),X=Math.sin(W.midAngle),Z=X>0?X:0;this.startX=(V?(W.centerX+W.darkCenterX)/2:W.centerX)+C*Y;this.startY=(V?(W.centerY+W.darkCenterY)/2:W.centerY)+C*X;this.left=(V?W.darkCenterX:W.centerX)+C*aa*Y+(this.floatright?0:-this.width);this.top=(V?W.darkCenterY:W.centerY)+C*aa*X+Z*this.length-this.length-h};this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2}};var A=function(Y,k,ah,W,ae,Q,T,X,ag,aa,aj,ac){var V=c(W,ae,Q,T);X=X||LChart.Methods.getDarkenColor(ah);var S=(ag?0:u)||0.05;p.ctx.save();p.ctx.transform(H,0,0,G,0,0);switch(k){case 0:p.DrawFigures.createRingReflection(V,X,0,d,false,Y!=0);break;case 1:p.DrawFigures.createCloseFigure([[V.iEndX,V.iEndY],[V.d_iEndX,V.d_iEndY],[V.d_oEndX,V.d_oEndY],[V.oEndX,V.oEndY]],X);break;case 2:p.DrawFigures.createCloseFigure([[V.iStartX,V.iStartY],[V.d_iStartX,V.d_iStartY],[V.d_oStartX,V.d_oStartY],[V.oStartX,V.oStartY]],X);break;default:p.DrawFigures.createRing(V.centerX,V.centerY,V.innerRadius,V.outerRadius,ah,Q,T,S,d);if(Y==0&&y(Q)){p.DrawFigures.createLine(V.oStartX,V.oStartY,V.d_oStartX,V.d_oStartY,S,d)}break}p.ctx.restore();var P=n.outerLabel;if(aa){var U=P.length||C/12;var Z=LChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,V.midAngle);var ai=LChart.Methods.JudgeBetweenAngle(-Math.PI,0,V.midAngle);var af=P.content(aj);var R=p.DrawFigures.measureText(af,null,P.fontsize||(U-1),P.fontfamily);var ad=R+(P.withlegend?U+3*i:2*i);var ab=U+h*2;var O=new v(af,U,ad,ab,Z?1:0,ai?1:0,aj,ac);t.outerLabels.push(O);ac.contact=O}};var M=function(R){var Q=n.innerLabel;if(!(Q.show&&typeof Q.content=="function")){return}var P=function(S){var X=(S.angleMin+S.angleMax)/2;var U=S.data;var T=(S.innerRadius+S.outerRadius)/2;var W=z.centerX+T*Math.cos(X);var V=z.centerY+T*Math.sin(X);p.ctx.save();p.ctx.transform(H,0,0,G,0,0);p.DrawFigures.createText(Q.content(U),W,V,"center",U.fontweight,U.fontsize||Q.fontsize||LChart.Methods.CapValue((S.outerRadius-S.innerRadius)/3,15,11),Q.fontfamily,U.fontcolor||Q.color||LChart.Const.Defaults.InnerLabelColor);p.ctx.restore()};if(R){P(R)}else{for(var O=0,k;k=t.cemicircles[O];O++){P(k)}}};var s=function(U,R){var O=n.outerLabel;if(!(O.show&&typeof O.content=="function")){return}var P=(w?z.coordinate.minY:5)/G;var k=(w?z.coordinate.maxY:p.canvas.height-5)/G;t.outerLabels.sort(function(X,W){return X.index-W.index});if(e){for(var Q=0,T;T=t.outerLabels[Q];Q++){T.resetposition()}e=false}var S=function(){var ac=function(ah,ag){return Math.max(ah.left,ag.left)<=Math.min(ah.left+ah.width,ag.left+ag.width)&&Math.max(ah.top,ag.top)<=Math.min(ah.top+ah.height,ag.top+ag.height)};var Y=[];var W=[];var ad=[];var X=[];for(var ab=0,af;af=t.outerLabels[ab];ab++){while(P>af.top){af.top+=h;af.left+=af.floatright?i:-i}while(k<af.top+af.height){af.top-=h;af.left+=af.floatright?i:-i}if(af.floatright&&af.floattop){ad.push(af)}else{if(af.floatright&&!af.floattop){X.push(af)}else{if(!af.floatright&&af.floattop){Y.push(af)}else{W.push(af)}}}}var ae=0;var aa=[];var Z=function(ah){if(aa.length>0){for(var ag=0,ai;ai=aa[ag];ag++){while(ac(ai,ah)&&ae<1000){ah.top+=ah.floattop?h:-h;ah.left+=ah.floatright?i:-i;ae++}}}aa.push(ah)};for(var ab=Y.length-1;ab>=0;ab--){Z(Y[ab])}aa=[];for(var ab=0;ab<W.length;ab++){Z(W[ab])}aa=[];for(var ab=0;ab<ad.length;ab++){Z(ad[ab])}aa=[];for(var ab=X.length-1;ab>=0;ab--){Z(X[ab])}};var V=function(Y,X){var W=Y;p.ctx.save();p.ctx.transform(H,0,0,G,0,0);if(!X){p.DrawFigures.createQuadraticCurve(W.startX,W.startY,W.startX*0.8+W.endX()*0.2,W.startY*0.2+W.endY()*0.8,W.endX(),W.endY(),1,O.bordercolor);if(O.backcolor){p.DrawFigures.createRectangleFill(W.left,W.top,W.width,W.height,O.backcolor)}var ac=O.fontsize||(W.length-1);var ab=W.left+(W.floatright?i+(O.withlegend?W.length+i:0):W.width-i);var aa=W.top+W.length/2+ac/2+h/2;p.DrawFigures.createText(W.content,ab,aa,W.floatright?"left":"right",null,ac,O.fontfamily,O.color);if(O.borderwidth&&O.borderwidth>0){p.DrawFigures.createRectangleBorder(W.left,W.top,W.width,W.height,O.borderwidth,O.bordercolor)}}if(O.withlegend){var Z=O.legendtype||"s";var X=X||W.color;p.DrawFigures.createPointElement(Z,W.left+i,W.top+h,W.length,X,Z!="x",X,2,Z=="x")
}p.ctx.restore()};if(U){V(U.contact,R)}else{S();p.coordinates.multiRing[o].outerlabels.length=0;for(var Q=0,T;T=t.outerLabels[Q];Q++){V(T);p.coordinates.multiRing[o].outerlabels[Q]={index:T.index,left:T.left,top:T.top,width:T.width,height:T.height}}}};var f=function(aa,am){var ab=n.animation&&n.animateScale?aa:1;var ae=n.animation&&n.animateRotate?aa:1;var al=C;var ad=am>=1;var Y=[],P=[];for(var ah=0;ah<D;ah++){var S=a?a[ah%a.length]:C/(D<=2?2*D:2*D-1);var W=g[ah%g.length];var af=al;al-=S;var U=al;var V=J;for(var aj=0,an;an=j[aj];aj++){var ac=an.value[ah];var T=aj+r*ah;var O=(ac/m[ah])*100;var ai=O/100*Math.PI*2*ae;var ag=an.color||B[aj%B.length];var Q=V;var R=V+p._formatSegmentAngle(ai);var Z=(Q+R)/2;var ao=null;if(ad){ao={index:T,color:ag,darksidecolor:an.darksidecolor,percent:O,value:ac,text:an.text,label:W,click:an.click,mouseover:an.mouseover,mouseleave:an.mouseleave,fontsize:an.fontsize,fontcolor:an.fontcolor,fontweight:an.fontweight};p.coordinates.multiRing[o].cemicircles.push({index:T,percent:O,angleMin:Q,angleMax:R,innerRadius:U,outerRadius:af})}var ak=new q(ah,aj,ag,an.darksidecolor,U,af,O,Q,R,Z,ao);Y.push(ak);V=R}}P=p._get3DFaceDrawOrder(Y,F,E);for(var aj=0,X;X=P[aj];aj++){X.enable=true;if(X.type!=3&&X.shape.indexX>0&&X.shape.indexX<D-1){X.enable=false}}for(var aj=0,X;X=P[aj];aj++){if(X.enable){A(X.shape.indexX,X.type,X.shape.color,X.shape.innerRadius*ab,X.shape.outerRadius*ab,X.shape.angleMin,X.shape.angleMax,X.shape.darksidecolor,false,ad&&X.shape.indexX==0&&X.type==3,X.shape.data,X.shape)}}if(ad){t.cemicircles=Y;t.faces=P;M();s()}};var x=function(){var Q=function(S){S.isHovered=true;var T=n.mouseoverTransparency;S.redraw("rgba(255,255,255,"+(T>0&&T<1?T:0.2)+")");if(S.showTip){S.showTip()}};var P=function(aa,Z){var T=null;for(var W=0,Y;Y=t.cemicircles[W];W++){var V=Y.computeinfo();var U=LChart.Methods.GetCurrentAngle(aa,Z,V.centerX,V.centerY);var X=Math.pow(aa-V.centerX,2)+Math.pow(Z-V.centerY,2);if(X>=Math.pow(V.innerRadius,2)&&X<=Math.pow(V.outerRadius,2)&&LChart.Methods.JudgeBetweenAngle(Y.angleMin,Y.angleMax,U)){T=Y;break}}if(!T){for(var W=t.cemicircles.length-1;W>=0;W--){var Y=t.cemicircles[W];var V=Y.computeinfo();var X=Math.pow(aa-V.darkCenterX,2)+Math.pow(Z-V.darkCenterY,2);var S=LChart.Methods.GetCurrentAngle(aa,Z,V.darkCenterX,V.darkCenterY);if(X>=Math.pow(V.innerRadius,2)&&X<=Math.pow(V.outerRadius,2)&&LChart.Methods.JudgeBetweenAngle(Y.angleMin,Y.angleMax,S)){T=Y;break}}}return T};var R=function(S,W){var T=null;for(var V=0,U;U=t.outerLabels[V];V++){if(S>=U.left&&S<=U.left+U.width&&W>=U.top&&W<=U.top+U.height){T=U.index;break}}return T};var O=function(U){var U=window.event||U;var S=LChart.Methods.tranferLocation(p._getMouseLoction(U),H,G);var T=P(S.X,S.Y);if(T){T.click(U)}};var k=function(Y){var Y=window.event||Y;var U=LChart.Methods.tranferLocation(p._getMouseLoction(Y),H,G);var X=P(U.X,U.Y)||R(U.X,U.Y);if(X){p._configs.cursorPointer=true}if(N.currentMouseTarget!=X){var V=N.currentMouseTarget;if(V&&V.data){var S=typeof V.data.mouseleave=="function"?V.data.mouseleave:(n.mouseleave||null);if(S){S(V.data,Y)}}if(N.currentMouseTarget!=null){p.redrawAll()}N.currentMouseTarget=X;for(var W=0,V;V=t.cemicircles[W];W++){if(V.isHovered){V.isHovered=false;if(V.hideTip){V.hideTip()}}}if(X!=null){if(X.data){Q(X);var T=typeof X.data.mouseover=="function"?X.data.mouseover:(n.mouseover||null);if(T){T(X.data,Y)}}else{for(var W=0,V;V=t.cemicircles[W];W++){if(V.indexY%r==X){Q(V)}}}}}};p._addEventListener("click",O);p._addEventListener("mousemove",k)};var b=function(){for(var k=0,O;O=t.faces[k];k++){if(O.enable){A(O.shape.indexX,O.type,O.shape.color,O.shape.innerRadius,O.shape.outerRadius,O.shape.angleMin,O.shape.angleMax,O.shape.darksidecolor)}}M();s()};return{drawSegments:f,mouseEvents:x,redraw:b}};