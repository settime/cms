if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.HeapHistogram={CutLinecolor:null,InnerLabelColor:null}}LChart.HeapHistogram=LChart.getCore().__extends({GraphType:"HeapHistogram"});LChart.HeapHistogram._spreadSkin=function(b,a){b.histogram={};b.label={};b.histogram.cutlinecolor=a.CutLinecolor||null;b.label.color=a.InnerLabelColor||null};LChart.HeapHistogram._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{animateY:true,animateX:true,histogram:{colors:null,length:null,cutlinecolor:null,cutlinewidth:null},label:{show:true,content:function(c){return this.valueType=="p"?c.percent.toFixed(1)+"%":c.value.toString()},color:null,fontweight:null,fontsize:null,fontfamily:null}});return a};LChart.HeapHistogram._getCheckOptions=function(){return{__top:[["animateY","b"],["animateX","b"]],histogram:[["colors","ca"],["length","n"],["cutlinecolor","c"],["cutlinewidth","n"]],label:[["show","b"],["content","f"],["color","c"],["fontweight","s"],["fontsize","n"],["fontfamily","s"]]}};LChart.HeapHistogram._drawgraphic=function(t,j,o,f){if(f.valueType&&f.valueType!="n"&&f.valueType!="p"){throw new Error(t._messages.WrongParam+t._messages.ValueTypeMustBeNumberOrPercent)}if(!LChart.Methods.IsArray(o[0].value)){throw new Error(t._messages.WrongData+t._messages.DataMustBeMultipleArray)}if(j==t.ID){t._configs.notAllowValueNegative=true}var h=t._formatAxisData(true);var c=t._calculateOutersValid();var s=t._computeAxis(c);var r=t._getDrawableCoordinate();var d=Math.floor(f.histogram.cutlinewidth||0);var i=f.histogram.cutlinecolor||"#ffffff";var a=d>0;var b=h.vValueType=="p";var g=f.histogram.length;if(g&&g>0){var e=s.labelDistance*0.8;g=Math.min(g,e)}else{g=s.labelDistance*0.6}var k=(f.histogram.colors&&f.histogram.colors.length>0?f.histogram.colors:null)||LChart.Const.Defaults.FillColors;if(j==t.ID){t.coordinates.draw=r;t._configs.legendColors=k}var u=t._configs.specificConfig[j];t.shapes[j]={histograms:[]};if(!t.coordinates.histograms){t.coordinates.histograms={}}t.coordinates.histograms[j]=[];var q=function(x,D,v,E,z,B,F){if(!F){t.DrawFigures.createRectangleFill(x,D,v,E,z)}if(B&&f.label.show){var w=f.label;var C=typeof w.content=="function"?w.content.call(f,B):"";if(C){var A=x+v/2;var G=w.fontsize||LChart.Methods.CapValue(v/2,18,11);var y=D+E/2+G/3;var z=w.color||"#ffffff";t.DrawFigures.createText(C,A,y,"center",B.fontweight||w.fontweight,B.fontsize||G,w.fontfamily,B.fontcolor||z)}}};var m=function(D,B,w,A,v,C,x,y,z){this.indexX=D;this.indexY=B;this.left=w;this.top=A;this.width=v;this.height=C;this.data=y;this.linetop=z;this.isHovered=false;this.color=x;this.redrawrect=function(E){q(this.left,this.top,this.width,this.height,E||this.color)};this.redrawtext=function(){q(this.left,this.top,this.width,this.height,x||this.color,this.data,true)};this.click=function(F){var E=typeof this.data.click=="function"?this.data.click:(f.click||null);if(E){E(this.data,F)}};if(f.tip.show&&typeof f.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var G=this.left+this.width;var F=this.top+this.height/2;this.tip=t._createTip(f.tip.content.call(f,this.data),G,F);if(G+this.tip.clientWidth>s.maxX){t._changeTip(this.tip,G-this.tip.clientWidth-this.width)}var E=this;E.tip.onclick=function(H){E.click(H)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var n=function(A,L){var B=function(Q){var P=(f.animateY?A:1)*(s.maxY-s.minY)*t._getFormatDiff(h.vValueType,h.vMinValue,Q)/t._getFormatDiff(h.vValueType,h.vMinValue,h.vMaxValue);return P};var F=(f.animateX?A:1)*g;for(var J=0;J<h.tuftCount;J++){var y=s.startPos+s.labelDistance*J-g/2;var E=0;var x=[];var z=[];for(var G=0;G<h.demanCount;G++){var M=o[G];var H=M.color||k[G%k.length];var w=b?M.percent:M.value;var O=w[J];if(O!=null){var D=B(O);E+=D;var C=s.maxY-E;if(C<s.minY+1){D-=s.minY+1-C;C=s.minY+1}if(G<h.demanCount-1){C+=d/2}if(G==h.demanCount-1||G==0){D-=d/2}else{D-=d}if(D+C>s.maxY){D=s.maxY-C}var K=null;if(a&&G<h.demanCount-1){K=C-d/2;if(K+d/2+1>s.maxY){K=s.maxY-d/2-1}x.push(K)}if(L>=1){var N={click:M.click,mouseover:M.mouseover,mouseleave:M.mouseleave,label:h.lLabels[J],text:M.text,indexX:J,indexY:G,fontsize:M.fontsize,fontcolor:M.fontcolor,fontweight:M.fontweight};if(b){N.percent=O;N.value=M.value[J]}else{N.value=O}var v=new m(G,J,y,C,F,D,H,N,K);t.shapes[j].histograms.push(v);z.push(v);v.redrawrect();if(!t.coordinates.histograms[j][J]){t.coordinates.histograms[j][J]=[]}t.coordinates.histograms[j][J][G]={left:y,top:C,width:F,height:D,color:H}}else{q(y,C,F,D,H)}}}if(a){for(var I=0;I<x.length;I++){t.DrawFigures.createLine(y,x[I],y+F,x[I],d,i)}}if(L>=1){for(var I=0,v;v=z[I];I++){v.redrawtext()}}}};var l=function(){var x=function(z,D){var C=null;for(var B=0,A;A=t.shapes[j].histograms[B];B++){if(A.left<=z&&A.left+A.width>=z&&A.top<=D&&A.top+A.height>=D){C=A;break
}}return C};var w=function(A){var A=window.event||A;var y=t._getMouseLoction(A);var z=x(y.X,y.Y);if(z){z.click(A)}};var v=function(E){var E=window.event||E;var A=t._getMouseLoction(E);var D=x(A.X,A.Y);if(D){t._configs.cursorPointer=true}if(u.currentMouseShape!=D){var B=u.currentMouseShape;if(B){B.isHovered=false;if(B.hideTip){B.hideTip()}var y=typeof B.data.mouseleave=="function"?B.data.mouseleave:(f.mouseleave||null);if(y){y(B.data,E)}}if(u.currentMouseShape){t.redrawAll()}u.currentMouseShape=D;if(D){D.isHovered=true;var C=f.mouseoverTransparency;D.redrawrect("rgba(255,255,255,"+(C>0&&C<1?C:0.2)+")");if(D.showTip){D.showTip()}var z=typeof D.data.mouseover=="function"?D.data.mouseover:(f.mouseover||null);if(z){z(D.data,E)}}}};t._addEventListener("click",w);t._addEventListener("mousemove",v)};var p=function(){for(var w=0,v;v=t.shapes[j].histograms[w];w++){v.redrawrect()}for(var w=0,v;v=t.shapes[j].histograms[w];w++){if(v.linetop!=null){t.DrawFigures.createLine(v.left,v.linetop,v.left+v.width,v.linetop,d,i)}}for(var w=0,v;v=t.shapes[j].histograms[w];w++){v.redrawtext()}};return{drawSegments:n,mouseEvents:l,redraw:p}};