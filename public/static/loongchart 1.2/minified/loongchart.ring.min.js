if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.Ring={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:"rgba(255,255,255,0.3)"}}LChart.Ring=LChart.getCore().__extends({GraphType:"Ring"});LChart.Ring._spreadSkin=function(b,a){b.separateLine={};b.innerLabel={};b.outerLabel={};b.separateLine.color=a.SeparateLineColor||null;b.innerLabel.color=a.InnerLabelColor||null;b.outerLabel.color=a.OuterLabelColor||null;b.outerLabel.bordercolor=a.OuterLabelBorderColor||null;b.outerLabel.backcolor=a.OuterLabelBackColor||null};LChart.Ring._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{offX:0,offY:0,innerRadius:null,outerRadius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,clickout:true,separateLine:{show:false,color:null,width:null},innerLabel:{show:true,content:function(c){return c.percent.toFixed(1)+"%"},distance:null,color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(c){return c.text+" "+c.percent.toFixed(1)+"%"},withlegend:true,legendtype:null,length:null,color:null,backcolor:"rgba(255,255,255,0.3)",bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return a};LChart.Ring._getCheckOptions=function(){return{__top:[["offX","n"],["offY","n"],["innerRadius","n"],["outerRadius","n"],["margin","n"],["colors","ca"],["animateRotate","b"],["animateScale","b"],["startAngle","n"],["clickout","b"]],separateLine:[["show","b"],["color","c"],["width","n"]],innerLabel:[["show","b"],["content","f"],["distance","n"],["color","c"],["fontsize","n"],["fontfamily","s"]],outerLabel:[["show","b"],["content","f"],["withlegend","b"],["legendtype","s"],["length","n"],["backcolor","c"],["bordercolor","c"],["borderwidth","n"],["color","c"],["fontsize","n"],["fontfamily","s"]]}};LChart.Ring._drawgraphic=function(x,k,t,e){var b=x._computeSegmentTotal(t).segmentTotal;var r=e.separateLine.show?(e.separateLine.width||0.5):0;var w=x._computeRadiusForPies(e);var a=!e.outerRadius||!LChart.Methods.IsNumber(e.outerRadius)?w.maxRadius:e.outerRadius;var f=e.innerRadius&&e.innerRadius>a*0.1&&e.innerRadius<a?e.innerRadius:a*0.7;if(a<=f){throw new Error(x._messages.WrongSet+x._messages.OuterRadiusShouldBigger)}var i=k==x.ID;var l=(e.colors&&e.colors.length>0?e.colors:null)||LChart.Const.Defaults.FillColors;if(i){x.coordinates.draw=w.coordinate;x._configs.legendColors=l}var s=a/10;if(!x.coordinates.ring){x.coordinates.ring={}}x.coordinates.ring[k]={outerRadius:a,innerRadius:f,centerX:w.centerX,centerY:w.centerY,cemicircles:[],outerlabels:[]};x.shapes[k]={cemicircles:[],outerLabels:[]};var o=x.shapes[k];var d=3;var c=3;var j=true;var y=x._configs.specificConfig[k];var n=function(A,z,C,B,D){this.index=A;this.angleMin=z;this.angleMax=C;this.data=B;this.isHovered=false;this.isClickout=D;this.color=function(){return this.data.color||l[this.index%l.length]};this.redraw=function(E,F){v(E,1,this.angleMin,this.angleMax,F||this.color())};this.contact=null;this.click=function(I,E){if(e.clickout){j=true;this.isClickout=!this.isClickout;x.redrawAll();var G=e.mouseoverTransparency;var F="rgba(255,255,255,"+(G>0&&G<1?G:0.2)+")";this.redraw(this.isClickout,F);q(this,F)}if(!e.clickout||this.isClickout){var H=typeof this.data.click=="function"?this.data.click:(e.click||null);if(H){H(this.data,I)}}};if(e.tip.show&&typeof e.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var H=(this.angleMin+this.angleMax)/2;var G=w.centerX+(a+f)/2*Math.cos(H);var F=w.centerY+(a+f)/2*Math.sin(H);this.tip=x._createTip(e.tip.content(this.data),G,F);var E=this;E.tip.onclick=function(I){E.click(I)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var g=function(F,E,D,B,A,C,G,z){this.content=F;this.length=E;this.width=D;this.height=B;this.floatright=A;this.floattop=C;this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2};this.data=G;this.contact=z;this.color=function(){return this.contact.color()};this.index=function(){return this.contact.index};this.resetposition=function(){var I=this.length;var N=w.centerX;var K=w.centerY;var M=(this.contact.angleMin+this.contact.angleMax)/2;var J=Math.cos(M);var H=Math.sin(M);if(this.contact.isClickout){N+=s*J;K+=s*H}var O=1.15;var L=H>0?H:0;this.startX=N+a*J;this.startY=K+a*H;this.left=N+a*O*J+(this.floatright?0:-this.width);this.top=K+a*O*H+L*I-I-c}};var v=function(B,U,C,E,Q,T,M){var J=(C+E)/2;var I=w.centerX;var H=w.centerY;var N=Math.cos(J);var G=Math.sin(J);if(B){I+=s*N;H+=s*G}var R=e.separateLine.show?(e.separateLine.width||1):0;x.DrawFigures.createRing(I,H,f*U,a*U,Q,C,E,R,e.separateLine.color);var A=e.outerLabel;if(T&&A.show&&typeof A.content=="function"){var F=A.length||a/12;var K=LChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,J);
var S=LChart.Methods.JudgeBetweenAngle(-Math.PI,0,J);var P=A.content(T);var D=x.DrawFigures.measureText(P,null,A.fontsize||(F-1),A.fontfamily);var O=D+(A.withlegend?F+3*d:2*d);var L=F+c*2;var z=new g(P,F,O,L,K?1:0,S?1:0,T,M);o.outerLabels.push(z);M.contact=z}};var h=function(D){var C=e.innerLabel;if(!(C.show&&typeof C.content=="function")){return}var E=(C.distance||0.5);var B=function(F){var K=(F.angleMin+F.angleMax)/2;var H=F.data;var G=f+(a-f)*E+(F.isClickout?s:0);var J=w.centerX+G*Math.cos(K);var I=w.centerY+G*Math.sin(K);x.DrawFigures.createText(C.content(H),J,I,"center",H.fontweight,H.fontsize||C.fontsize||a/10,C.fontfamily,H.fontcolor||C.color||LChart.Const.Defaults.InnerLabelColor)};if(D){B(D)}else{for(var A=0,z;z=o.cemicircles[A];A++){B(z)}}};var q=function(G,D){var A=e.outerLabel;if(!(A.show&&typeof A.content=="function")){return}var B=i?w.coordinate.minY:5;var z=i?w.coordinate.maxY:x.canvas.height-5;if(j){for(var C=0,F;F=o.outerLabels[C];C++){F.resetposition()}j=false}var E=function(){var O=function(T,S){return Math.max(T.left,S.left)<=Math.min(T.left+T.width,S.left+S.width)&&Math.max(T.top,S.top)<=Math.min(T.top+T.height,S.top+S.height)};var K=[];var I=[];var P=[];var J=[];for(var N=0,R;R=o.outerLabels[N];N++){while(B>R.top){R.top+=c;R.left+=R.floatright?d:-d}while(z<R.top+R.height){R.top-=c;R.left+=R.floatright?d:-d}if(R.floatright&&R.floattop){P.push(R)}else{if(R.floatright&&!R.floattop){J.push(R)}else{if(!R.floatright&&R.floattop){K.push(R)}else{I.push(R)}}}}var Q=0;var M=[];var L=function(T){if(M.length>0){for(var S=0,U;U=M[S];S++){while(O(U,T)&&Q<1000){T.top+=T.floattop?c:-c;T.left+=T.floatright?d:-d;Q++}}}M.push(T)};for(var N=K.length-1;N>=0;N--){L(K[N])}M=[];for(var N=0;N<I.length;N++){L(I[N])}M=[];for(var N=0;N<P.length;N++){L(P[N])}M=[];for(var N=J.length-1;N>=0;N--){L(J[N])}};var H=function(K,J){var I=K;if(!J){x.DrawFigures.createQuadraticCurve(I.startX,I.startY,I.startX*0.8+I.endX()*0.2,I.startY*0.2+I.endY()*0.8,I.endX(),I.endY(),1,A.bordercolor);if(A.backcolor){x.DrawFigures.createRectangleFill(I.left,I.top,I.width,I.height,A.backcolor)}var O=A.fontsize||(I.length-1);var N=I.left+(I.floatright?d+(A.withlegend?I.length+d:0):I.width-d);var M=I.top+I.length/2+O/2+c/2;x.DrawFigures.createText(I.content,N,M,I.floatright?"left":"right",null,O,A.fontfamily,A.color);if(A.borderwidth&&A.borderwidth>0){x.DrawFigures.createRectangleBorder(I.left,I.top,I.width,I.height,A.borderwidth,A.bordercolor)}}if(A.withlegend){var L=A.legendtype||"s";var J=J||I.color();x.DrawFigures.createPointElement(L,I.left+d,I.top+c,I.length,J,L!="x",J,2,L=="x")}};if(G){H(G.contact,D)}else{E();x.coordinates.ring[k].outerlabels.length=0;for(var C=0,F;F=o.outerLabels[C];C++){H(F);x.coordinates.ring[k].outerlabels[C]={index:F.contact.index,left:F.left,top:F.top,width:F.width,height:F.height}}}};var u=function(){for(var A=0,z;z=o.cemicircles[A];A++){z.redraw(z.isClickout)}h();q()};var p=function(z,C){var G=Math.PI*(e.startAngle==null?-0.5:e.startAngle);var F=e.animation&&e.animateScale?z:1;var I=e.animation&&e.animateRotate?z:1;for(var D=0,K;K=t[D];D++){var H=(K.value/b)*100;var A=I*(H/100*(Math.PI*2));var B=K.color||l[D%l.length];var J=G+x._formatSegmentAngle(A);if(C>=1){K.index=D;K.percent=H;var E=new n(D,G,J,K,K.extended==true);o.cemicircles.push(E);v(K.extended,F,G,J,B,K,E);x.coordinates.ring[k].cemicircles.push({index:D,percent:H,angleMin:G,angleMax:J,color:B})}else{v(K.extended,F,G,J,B)}G=J}if(C>=1){h();q()}};var m=function(){var B=function(N,L){var E=null;for(var I=0,K;K=o.cemicircles[I];I++){var D=(K.angleMin+K.angleMax)/2;var P=s*Math.cos(D);var O=s*Math.sin(D);var H=w.centerX+(K.isClickout?P:0);var G=w.centerY+(K.isClickout?O:0);var F=LChart.Methods.GetCurrentAngle(N,L,H,G);var J=Math.pow(N-H,2)+Math.pow(L-G,2);var C=J>=Math.pow(f,2)&&J<=Math.pow(a,2)&&LChart.Methods.JudgeBetweenAngle(K.angleMin,K.angleMax,F);var Q=false;if(e.outerLabel&&e.outerLabel.show&&K.contact){var M=K.contact;if(N>=M.left&&N<=M.left+M.width&&L>=M.top&&L<=M.top+M.height){Q=true}}if(C||Q){E=K;break}}return E};var A=function(E){var E=window.event||E;var C=x._getMouseLoction(E);var D=B(C.X,C.Y);if(D){D.click(E)}};var z=function(G){var G=window.event||G;var J=x._getMouseLoction(G);var E=B(J.X,J.Y);if(E){x._configs.cursorPointer=true}if(y.currentMouseShape!=E){var H=y.currentMouseShape;if(H){var D=typeof H.data.mouseleave=="function"?H.data.mouseleave:(e.mouseleave||null);if(D){D(H.data,G)}}if(y.currentMouseShape){x.redrawAll()}y.currentMouseShape=E;for(var F=0,H;H=o.cemicircles[F];F++){if(H.isHovered){H.isHovered=false;if(H.hideTip){H.hideTip()}}}if(E){E.isHovered=true;var C=e.mouseoverTransparency;var I="rgba(255,255,255,"+(C>0&&C<1?C:0.2)+")";E.redraw(E.isClickout,I);q(E,I);if(E.showTip){E.showTip()}var K=typeof E.data.mouseover=="function"?E.data.mouseover:(e.mouseover||null);if(K){K(E.data,G)}}}};x._addEventListener("click",A);x._addEventListener("mousemove",z)};return{drawSegments:p,mouseEvents:m,redraw:u}};