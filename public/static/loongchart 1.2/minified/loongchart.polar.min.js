if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.Polar={SeparateLineColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:"rgba(255,255,255,0.3)",StaffFontColor:null,StaffBackColor:null,ScaleLineColors:null}}LChart.Polar=LChart.getCore().__extends({GraphType:"Polar"});LChart.Polar._spreadSkin=function(b,a){b.separateLine={};b.outerLabel={};b.staff={};b.scale={};b.separateLine.color=a.SeparateLineColor||null;b.outerLabel.color=a.OuterLabelColor||null;b.outerLabel.backcolor=a.OuterLabelBackColor||null;b.outerLabel.bordercolor=a.OuterLabelBorderColor||null;b.staff.fontcolor=a.StaffFontColor||null;b.staff.backcolor=a.StaffBackColor||null;b.scale.linecolors=a.ScaleLineColors||null};LChart.Polar._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{offX:0,offY:0,radius:null,margin:null,colors:null,animateRotate:true,animateScale:true,scaleOverlay:true,startAngle:null,averageAngle:false,separateLine:{show:false,color:null,width:null},scale:{linewidth:0.5,minvalue:null,maxvalue:null,interval:null,linecolors:null},staff:{show:true,content:function(c){return c.toString()},fontcolor:null,fontfamily:null,fontsize:null,fontweight:null,directions:["n","s","e","w"],backcolor:"rgba(255,255,255,0.3)"},outerLabel:{show:true,content:function(c){return c.text+" "+c.percent.toFixed(1)+"%"},withlegend:true,legendtype:null,length:null,color:null,backcolor:"rgba(220,220,220,0.2)",bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return a};LChart.Polar._getCheckOptions=function(){return{__top:[["offX","n"],["offY","n"],["radius","n"],["margin","n"],["colors","ca"],["animateRotate","b"],["animateScale","b"],["startAngle","n"],["averageAngle","b"]],separateLine:[["show","b"],["color","c"],["width","n"]],scale:[["minvalue","n"],["maxvalue","n"],["interval","n"],["linecolors","ca"]],staff:[["show","b"],["content","f"],["fontcolor","c"],["fontfamily","s"],["fontsize","n"],["fontweight","s"],["directions","sa"],["backcolor","c"]],outerLabel:[["show","b"],["content","f"],["withlegend","b"],["legendtype","s"],["length","n"],["color","c"],["backcolor","c"],["bordercolor","c"],["borderwidth","n"],["fontsize","n"],["fontfamily","s"]]}};LChart.Polar._drawgraphic=function(x,l,t,f){var n=x._computeSegmentTotal(t);var d=t.length;var w=x._computeRadiusForPies(f);var m=(f.colors&&f.colors.length>0?f.colors:null)||LChart.Const.Defaults.FillColors;var j=l==x.ID;if(j){x.coordinates.draw=w.coordinate;x._configs.legendColors=m}var h=x._getComputed(0,"n",f.scale,n.minval,n.maxval,8);var a=!f.radius||!LChart.Methods.IsNumber(f.radius)?w.maxRadius:f.radius;if(!x.coordinates.polar){x.coordinates.polar={}}x.coordinates.polar[l]={radius:a,centerX:w.centerX,centerY:w.centerY,outerlabels:[],staff:[],cemicircles:[]};x.shapes[l]={cemicircles:[],outerLabels:[]};var q=x.shapes[l];var c=3;var b=3;var k=true;var y=x._configs.specificConfig[l];var o=function(B,A,D,C,z){this.index=B;this.angleMin=A;this.angleMax=D;this.data=C;this.isHovered=false;this.radius=z;this.color=function(){return this.data.color||m[this.index%m.length]};this.redraw=function(E){v(e(this.data.value),this.angleMin,this.angleMax,E||this.color())};this.contact=null;this.click=function(F){var E=typeof this.data.click=="function"?this.data.click:(f.click||null);if(E){E(this.data,F)}};if(f.tip.show&&typeof f.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var H=(this.angleMin+this.angleMax)/2;var G=w.centerX+this.radius*0.5*Math.cos(H);var F=w.centerY+this.radius*0.5*Math.sin(H);this.tip=x._createTip(f.tip.content(this.data),G,F);var E=this;E.tip.onclick=function(I){E.click(I)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var g=function(F,E,D,B,A,C,G,z){this.content=F;this.length=E;this.width=D;this.height=B;this.floatright=A;this.floattop=C;this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2};this.data=G;this.contact=z;this.color=function(){return this.contact.color()};this.index=function(){return this.contact.index};this.resetposition=function(){var I=this.length;var N=w.centerX;var K=w.centerY;var M=(this.contact.angleMin+this.contact.angleMax)/2;var J=Math.cos(M);var H=Math.sin(M);var O=1.1;var L=H>0?H:0;this.startX=N+this.contact.radius*J;this.startY=K+this.contact.radius*H;this.left=N+a*O*J+(this.floatright?0:-this.width);this.top=K+a*O*H+L*I-I-b}};var e=function(z){return(z-h.minvalue)/(h.maxvalue-h.minvalue)};var v=function(T,B,D,P,S,J){var I=(B+D)/2;var H=w.centerX;var G=w.centerY;var M=Math.cos(I);var F=Math.sin(I);var Q=f.separateLine.show?(f.separateLine.width||1):0;x.DrawFigures.createArc(H,G,a*T,Q,f.separateLine.color,P,B,D,true);var A=f.outerLabel;if(S&&A.show&&typeof A.content=="function"){var E=A.length||a/12;var K=LChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,I);
var R=LChart.Methods.JudgeBetweenAngle(-Math.PI,0,I);var O=A.content(S);var C=x.DrawFigures.measureText(O,null,A.fontsize||(E-1),A.fontfamily);var N=C+(A.withlegend?E+3*c:2*c);var L=E+b*2;var z=new g(O,E,N,L,K?1:0,R?1:0,S,J);q.outerLabels.push(z);J.contact=z}};var i=function(J){var A=f.scale;var K=A.linewidth;if(!(A.linewidth>0)){return}var D=0;for(var C=h.minvalue+h.interval;C<=h.maxvalue;C+=h.interval){var O=A.linecolors&&A.linecolors.length>0?A.linecolors[D%A.linecolors.length]:"rgb(190,190,190)";x.DrawFigures.createArc(w.centerX,w.centerY,a*e(C),K,O);D++}var I=f.staff;var G=I.content;if(!I.show||typeof G!="function"||I.directions==null||!(I.directions.length>0)){return}var H=I.fontsize||a/h.scalecount*0.6;var L=I.backcolor;var B=0;if(L){for(var C=h.minvalue+h.interval;C<=h.maxvalue;C+=h.interval){var E=x.DrawFigures.measureText(G(C),I.fontweight,H,I.fontfamily);B=Math.max(B,E)}}D=0;var F=function(T,S,U){var R=(S=="n"||S=="s")?w.centerX:(S=="w"?w.centerX-U:w.centerX+U);var P=(S=="w"||S=="e")?w.centerY+H/2.5:(S=="n"?w.centerY-U+H/2.5:w.centerY+U+H/2.5);if(L){x.DrawFigures.createRectangleFill(R-B/2-1,P-H+1,B+2,H+2,L)}var Q=x.DrawFigures.createText(T,R,P,"center",I.fontweight,H,I.fontfamily,M);if(J){x.coordinates.polar[l].staff.push({direction:S,text:T,left:R-Q/2,right:R+Q/2,top:P-H,bottom:P,size:H,length:Q})}};for(var C=h.minvalue+h.interval;C<=h.maxvalue;C+=h.interval){var M=I.fontcolor||"#000000";var z=a*e(C);var N=G(LChart.Methods.FormatNumber(C));if(I.directions.__contains("n")){F(N,"n",z)}if(I.directions.__contains("s")){F(N,"s",z)}if(I.directions.__contains("e")){F(N,"e",z)}if(I.directions.__contains("w")){F(N,"w",z)}D++}};var s=function(G,D){var A=f.outerLabel;if(!(A.show&&typeof A.content=="function")){return}var B=j?w.coordinate.minY:5;var z=j?w.coordinate.maxY:x.canvas.height-5;if(k){for(var C=0,F;F=q.outerLabels[C];C++){F.resetposition()}k=false}var E=function(){var O=function(T,S){return Math.max(T.left,S.left)<=Math.min(T.left+T.width,S.left+S.width)&&Math.max(T.top,S.top)<=Math.min(T.top+T.height,S.top+S.height)};var K=[];var I=[];var P=[];var J=[];for(var N=0,R;R=q.outerLabels[N];N++){while(B>R.top){R.top+=b;R.left+=R.floatright?c:-c}while(z<R.top+R.height){R.top-=b;R.left+=R.floatright?c:-c}if(R.floatright&&R.floattop){P.push(R)}else{if(R.floatright&&!R.floattop){J.push(R)}else{if(!R.floatright&&R.floattop){K.push(R)}else{I.push(R)}}}}var Q=0;var M=[];var L=function(T){if(M.length>0){for(var S=0,U;U=M[S];S++){while(O(U,T)&&Q<1000){T.top+=T.floattop?b:-b;T.left+=T.floatright?c:-c;Q++}}}M.push(T)};for(var N=K.length-1;N>=0;N--){L(K[N])}M=[];for(var N=0;N<I.length;N++){L(I[N])}M=[];for(var N=0;N<P.length;N++){L(P[N])}M=[];for(var N=J.length-1;N>=0;N--){L(J[N])}};var H=function(K,J){var I=K;if(!J){x.DrawFigures.createQuadraticCurve(I.startX,I.startY,I.startX*0.8+I.endX()*0.2,I.startY*0.2+I.endY()*0.8,I.endX(),I.endY(),1,A.bordercolor);if(A.backcolor){x.DrawFigures.createRectangleFill(I.left,I.top,I.width,I.height,A.backcolor)}var O=A.fontsize||(I.length-1);var N=I.left+(I.floatright?c+(A.withlegend?I.length+c:0):I.width-c);var M=I.top+I.length/2+O/2+b/2;x.DrawFigures.createText(I.content,N,M,I.floatright?"left":"right",null,O,A.fontfamily,A.color);if(A.borderwidth&&A.borderwidth>0){x.DrawFigures.createRectangleBorder(I.left,I.top,I.width,I.height,A.borderwidth,A.bordercolor)}}if(A.withlegend){var L=A.legendtype||"s";var J=J||I.color();x.DrawFigures.createPointElement(L,I.left+c,I.top+b,I.length,J,L!="x",J,2,L=="x")}};if(G){H(G.contact,D)}else{E();x.coordinates.polar[l].outerlabels.length=0;for(var C=0,F;F=q.outerLabels[C];C++){H(F);x.coordinates.polar[l].outerlabels[C]={index:F.contact.index,left:F.left,top:F.top,width:F.width,height:F.height}}}};var u=function(){if(!f.scaleOverlay){i()}for(var A=0,z;z=q.cemicircles[A];A++){z.redraw()}if(f.scaleOverlay){i()}s()};var r=function(z,D){var G=Math.PI*(f.startAngle==null?-0.5:f.startAngle);var F=f.animation&&f.animateScale?z:1;var J=f.animation&&f.animateRotate?z:1;if(!f.scaleOverlay){i(D>=1)}for(var E=0,L;L=t[E];E++){var I=(L.value/n.segmentTotal)*100;var B=J*Math.PI*2*(f.averageAngle?1/d:(I/100));var C=L.color||m[E%m.length];var H=F*e(L.value);var K=G+x._formatSegmentAngle(B);if(D>=1){L.percent=I;L.index=E;var A=new o(E,G,K,L,a*H);q.cemicircles.push(A);v(H,G,K,C,L,A);x.coordinates.polar[l].cemicircles.push({index:E,percent:I,radius:H,angleMin:G,angleMax:K,color:C})}else{v(H,G,K,C)}G=K}if(f.scaleOverlay){i(D>=1)}if(D>=1){s()}};var p=function(){var B=function(M,K){var E=null;for(var I=0,J;J=q.cemicircles[I];I++){var D=(J.angleMin+J.angleMax)/2;var H=w.centerX;var G=w.centerY;var F=LChart.Methods.GetCurrentAngle(M,K,H,G);var C=(Math.pow(M-H,2)+Math.pow(K-G,2)<=Math.pow(J.radius,2))&&LChart.Methods.JudgeBetweenAngle(J.angleMin,J.angleMax,F);var N=false;if(f.outerLabel&&f.outerLabel.show&&J.contact){var L=J.contact;if(M>=L.left&&M<=L.left+L.width&&K>=L.top&&K<=L.top+L.height){N=true}}if(C||N){E=J;break}}return E};var A=function(E){var E=window.event||E;var C=x._getMouseLoction(E);
var D=B(C.X,C.Y);if(D){D.click(E)}};var z=function(G){var G=window.event||G;var J=x._getMouseLoction(G);var E=B(J.X,J.Y);if(E){x._configs.cursorPointer=true}if(y.currentMouseShape!=E){var H=y.currentMouseShape;if(H){var D=typeof H.data.mouseleave=="function"?H.data.mouseleave:(f.mouseleave||null);if(D){D(H.data,G)}}if(y.currentMouseShape){x.redrawAll()}y.currentMouseShape=E;for(var F=0,H;H=q.cemicircles[F];F++){if(H.isHovered){H.isHovered=false;if(H.hideTip){H.hideTip()}}}if(E){E.isHovered=true;var C=f.mouseoverTransparency;var I="rgba(255,255,255,"+(C>0&&C<1?C:0.2)+")";E.redraw(I);s(E,I);if(E.showTip){E.showTip()}var K=typeof E.data.mouseover=="function"?E.data.mouseover:(f.mouseover||null);if(K){K(E.data,G)}}}};x._addEventListener("click",A);x._addEventListener("mousemove",z)};return{drawSegments:r,mouseEvents:p,redraw:u}};