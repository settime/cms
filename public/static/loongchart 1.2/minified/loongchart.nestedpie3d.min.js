if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.NestedPie3D={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:"rgba(255,255,255,0.3)"}}LChart.NestedPie3D=LChart.getCore().__extends({GraphType:"NestedPie3D"});LChart.NestedPie3D._spreadSkin=function(b,a){b.separateLine={};b.innerLabel={};b.outerLabel={};b.separateLine.color=a.SeparateLineColor||null;b.innerLabel.color=a.InnerLabelColor||null;b.outerLabel.color=a.OuterLabelColor||null;b.outerLabel.bordercolor=a.OuterLabelBorderColor||null;b.outerLabel.backcolor=a.OuterLabelBackColor||null};LChart.NestedPie3D._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{offX:0,offY:0,innerRadius:null,outerRadius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,reflection3d:{reflectoffX:null,reflectoffY:null,zoomX:null,zoomY:null},subitems:{outerlabalpoint:null,innerlabalpoint:null,inheritevents:true,showinnerlabels:false},separateLine:{color:null,width:null},innerLabel:{show:true,content:function(c){return c.percent.toFixed(1)+"%"},distance:null,color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(c){return c.text+" "+c.percent.toFixed(1)+"%"},withlegend:true,legendtype:null,length:null,color:null,backcolor:"rgba(255,255,255,0.3)",bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return a};LChart.NestedPie3D._getCheckOptions=function(){return{__top:[["offX","n"],["offY","n"],["innerRadius","n"],["outerRadius","n"],["margin","n"],["colors","ca"],["animateRotate","b"],["animateScale","b"],["startAngle","n"]],subitems:[["outerlabalpoint","n"],["innerlabalpoint","n"],["inheritevents","b"],["showinnerlabels","b"]],separateLine:[["color","c"],["width","n"]],innerLabel:[["show","b"],["content","f"],["distance","n"],["color","c"],["fontsize","n"],["fontfamily","s"]],outerLabel:[["show","b"],["content","f"],["withlegend","b"],["legendtype","s"],["length","n"],["backcolor","c"],["bordercolor","c"],["borderwidth","n"],["color","c"],["fontsize","n"],["fontfamily","s"]]}};LChart.NestedPie3D._drawgraphic=function(w,u,p,t){var o=3;var n=3;var R=t.reflection3d.zoomX||1.2;var P=t.reflection3d.zoomY||0.9;if(w._configs._isIE678.isIE678){R=1;P=1}var J=w._computeRadiusForPies(t,R,P);if(w._configs._isIE678.isIE678){J.maxRadius*=0.9}var r=!t.outerRadius||!LChart.Methods.IsNumber(t.outerRadius)?J.maxRadius:t.outerRadius;var F=t.innerRadius&&t.innerRadius>r*0.1&&t.innerRadius<r?t.innerRadius:r*0.7;if(r<=F){throw new Error(w._messages.WrongSet+w._messages.OuterRadiusShouldBigger)}var O=t.reflection3d.reflectoffX||0;var M=t.reflection3d.reflectoffY||r/6;var B=t.separateLine.width||1;var d=t.separateLine.color||"#ffffff";var S=Math.PI*(t.startAngle==null?-0.5:t.startAngle);var C=u==w.ID;var K=(t.colors&&t.colors.length>0?t.colors:null)||LChart.Const.Defaults.FillColors;if(C){w.coordinates.draw=J.coordinate;w._configs.legendColors=K}if(!w.coordinates.nestedpie){w.coordinates.nestedpie={}}w.coordinates.nestedpie[u]={outerRadius:r,innerRadius:F,centerX:J.centerX,centerY:J.centerY,cemicircles:[],outerlabels:[]};w.shapes[u]={cemicircles:[],outerlabels:[],faces:null};var z=w.shapes[u];var X=0;var m=[];var e=[];var q=[];for(var V=0,y;y=p[V];V++){var k=y.value;if(typeof k!="number"||k<0){throw new Error(w._messages.WrongData+"'"+k+"'"+w._messages.DataMustGreaterThanZero)}X+=k;m[V]=k;var l=y.subitems;if(LChart.Methods.IsArray(l)){e[V]=true;var g=0;for(var U=0,s;s=l[U];U++){var a=s.value;q.push(a);if(typeof a!="number"||a<0){throw new Error(w._messages.WrongData+"'"+a+"'"+w._messages.DataMustGreaterThanZero)}g+=a}if(!(Math.abs(g-k)<0.00001)){throw new Error(w._messages.WrongData+"'"+k+"'"+w._messages.SubItemsValueShouldEqualSuperValue)}}else{e[V]=false}}var f=true;var Q=t.subitems.inheritevents;var L=t.subitems.showinnerlabels;var Y=w._configs.specificConfig[u];var G=t.subitems.outerlabalpoint;var N=t.subitems.innerlabalpoint;var T=w._getReflectAngle(O,M);if(G==null||N==null){if(q.length>8){q.sort(function(i,j){return j-i});var D=q[8];if(G==null){G=D}if(N==null){N=D}}}var c=function(i,af,ad,al){var j=(ad+al)/2;var ab=J.centerX;var aa=J.centerY;var ae=Math.cos(j);var Z=Math.sin(j);var aj=ab+O;var ai=aa+M;var ah=F*af;var ac=r*af;var ak=function(ap,an,aq){var am=ap==0?ab:(ap==1?aa:(ap==2?aj:ai));var ao=ap==0||ap==2?Math.cos:Math.sin;return am+ao(an?al:ad)*(aq?ac:ah)};var ag={isInnerPie:i,midAngle:j,angleMin:ad,angleMax:al,innerRadius:ah,outerRadius:ac,centerX:ab,centerY:aa,darkCenterX:aj,darkCenterY:ai,iStartX:ak(0,0,0),iStartY:ak(1,0,0),iEndX:ak(0,1,0),iEndY:ak(1,1,0),d_iStartX:ak(2,0,0),d_iStartY:ak(3,0,0),d_iEndX:ak(2,1,0),d_iEndY:ak(3,1,0)};if(!i){ag.oStartX=ak(0,0,1);ag.oStartY=ak(1,0,1);ag.oEndX=ak(0,1,1);ag.oEndY=ak(1,1,1);ag.d_oStartX=ak(2,0,1);ag.d_oStartY=ak(3,0,1);ag.d_oEndX=ak(2,1,1);ag.d_oEndY=ak(3,1,1)
}return ag};var I=function(i){return LChart.Methods.computeDifferAngle(i,T*Math.PI)<Math.PI/2};var v=function(aa,Z,ab,j,i,ae,ad,ac){this.indexX=aa;this.indexY=Z;this.percent=ab;this.color=j;this.angleMin=i;this.angleMax=ae;this.midAngle=ad;this.data=ac;this.isHovered=false;this.isInnerPie=Z==null;this.redraw=function(af){var ah=af;for(var ag=0;ag<4;ag++){H(this.isInnerPie,ag,1,this.angleMin,this.angleMax,af||this.color,ah,ah?af:this.data.darksidecolor)}};this.contact=null;this.superShape=null;this.computeinfo=function(af){if(!this._computeinfo||af){this._computeinfo=c(this.isInnerPie,1,this.angleMin,this.angleMax)}return this._computeinfo};this.click=function(ah,ag){var af=typeof this.data.click=="function"?this.data.click:(t.click||null);if(af){af(ag||this.data,ah)}else{if(Q&&this.superShape){this.superShape.click(ah,this.data)}}};this.mouseover=function(ah,ag){var af=typeof this.data.mouseover=="function"?this.data.mouseover:(t.mouseover||null);if(af){af(ag||this.data,ah)}else{if(Q&&this.superShape){this.superShape.mouseover(ah,this.data)}}};this.mouseleave=function(ah,ag){var af=typeof this.data.mouseleave=="function"?this.data.mouseleave:(t.mouseleave||null);if(af){af(ag||this.data,ah)}else{if(Q&&this.superShape){this.superShape.mouseleave(ah,this.data)}}};if(t.tip.show&&typeof t.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var ai=(this.angleMin+this.angleMax)/2;var aj=this.isInnerPie?F:(r+F);var ah=J.centerX+aj/2*Math.cos(ai);var ag=J.centerY+aj/2*Math.sin(ai);this.tip=w._createTip(t.tip.content(this.data),ah*R,ag*P);var af=this;af.tip.onclick=function(ak){af.click(ak)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var A=function(ad,ac,ab,Z,j,aa,ae,i){this.content=ad;this.length=ac;this.width=ab;this.height=Z;this.floatright=j;this.floattop=aa;this.data=ae;this.contact=i;this.color=this.contact.color;this.index=this.contact.index;this.resetposition=function(){var af=i.isInnerPie?F:r;var ah=this.contact.computeinfo(),ag=I(ah.midAngle);var al=1.15,aj=Math.cos(ah.midAngle),ai=Math.sin(ah.midAngle),ak=ai>0?ai:0;this.startX=(ag?(ah.centerX+ah.darkCenterX)/2:ah.centerX)+af*aj;this.startY=(ag?(ah.centerY+ah.darkCenterY)/2:ah.centerY)+af*ai;this.left=(ag?ah.darkCenterX:ah.centerX)+r*al*aj+(this.floatright?0:-this.width);this.top=(ag?ah.darkCenterY:ah.centerY)+r*al*ai+ak*this.length-this.length-n};this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2}};var H=function(ag,i,at,aa,ad,ap,ao,ah,ar,al){var af=c(ag,at,aa,ad);ah=ah||LChart.Methods.getDarkenColor(ap);var ac=ao?0:B;w.ctx.save();w.ctx.transform(R,0,0,P,0,0);switch(i){case 0:if(ag){w.DrawFigures.createArc(af.darkCenterX,af.darkCenterY,af.innerRadius,0,null,ah,aa,ad,true)}else{w.DrawFigures.createRingReflection(af,ah,0,d)}break;case 1:if(ag){w.DrawFigures.createCloseFigure([[af.darkCenterX,af.darkCenterY],[af.centerX,af.centerY],[af.iEndX,af.iEndY],[af.d_iEndX,af.d_iEndY]],ah)}else{w.DrawFigures.createCloseFigure([[af.iEndX,af.iEndY],[af.d_iEndX,af.d_iEndY],[af.d_oEndX,af.d_oEndY],[af.oEndX,af.oEndY]],ah)}break;case 2:if(ag){w.DrawFigures.createCloseFigure([[af.darkCenterX,af.darkCenterY],[af.centerX,af.centerY],[af.iStartX,af.iStartY],[af.d_iStartX,af.d_iStartY]],ah)}else{w.DrawFigures.createCloseFigure([[af.iStartX,af.iStartY],[af.d_iStartX,af.d_iStartY],[af.d_oStartX,af.d_oStartY],[af.oStartX,af.oStartY]],ah)}break;default:if(ag){w.DrawFigures.createArc(af.centerX,af.centerY,af.innerRadius,ac,d,ap,aa,ad,true)}else{w.DrawFigures.createRing(af.centerX,af.centerY,af.innerRadius,af.outerRadius,ap,aa,ad,ac,d);if(ac>0&&I(aa)){w.DrawFigures.createLine(af.oStartX,af.oStartY,af.d_oStartX,af.d_oStartY,ac,d)}}break}w.ctx.restore();var Z=t.outerLabel;if(ar&&Z.show&&typeof Z.content=="function"&&((!ag&&(G==null||ar.value>G))||(ag&&!e[al.indexX]))){var ai=(aa+ad)/2;var ae=Z.length||r/12;var aj=LChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,ai);var aq=LChart.Methods.JudgeBetweenAngle(-Math.PI,0,ai);var an=Z.content(ar);var ab=w.DrawFigures.measureText(an,null,Z.fontsize||(ae-1),Z.fontfamily);var am=ab+(Z.withlegend?ae+3*o:2*o);var ak=ae+n*2;var j=new A(an,ae,am,ak,aj?1:0,aq?1:0,ar,al);z.outerlabels.push(j);al.contact=j}};var W=function(ac){var ab=t.innerLabel;if(!(ab.show&&typeof ab.content=="function")){return}var ad=ab.distance||0.5;var aa=function(af){var i=af.isInnerPie;var ae=!af.isInnerPie&&L&&(N==null||af.data.value>N);if(i||ae){var ak=(af.angleMin+af.angleMax)/2;var ah=af.data;var ag=i?(F+r)/2*ad:F+(r-F)*ad;var aj=J.centerX+ag*Math.cos(ak);var ai=J.centerY+ag*Math.sin(ak);w.ctx.save();w.ctx.transform(R,0,0,P,0,0);w.DrawFigures.createText(ab.content(ah),aj,ai,"center",ah.fontweight,ah.fontsize||ab.fontsize||r/10,ab.fontfamily,ah.fontcolor||ab.color||LChart.Const.Defaults.InnerLabelColor);w.ctx.restore()}};if(ac){aa(ac)}else{for(var Z=0,j;j=z.cemicircles[Z];Z++){aa(j)}}};var x=function(af,ac){var Z=t.outerLabel;
if(!(Z.show&&typeof Z.content=="function")){return}var aa=(C?J.coordinate.minY:5)/P;var j=(C?J.coordinate.maxY:w.canvas.height-5)/P;z.outerlabels.sort(function(ah,i){return ah.index-i.index});if(f){for(var ab=0,ae;ae=z.outerlabels[ab];ab++){ae.resetposition()}f=false}var ad=function(){var an=function(ar,i){return Math.max(ar.left,i.left)<=Math.min(ar.left+ar.width,i.left+i.width)&&Math.max(ar.top,i.top)<=Math.min(ar.top+ar.height,i.top+i.height)};var aj=[];var ah=[];var ao=[];var ai=[];for(var am=0,aq;aq=z.outerlabels[am];am++){while(aa>aq.top){aq.top+=n;aq.left+=aq.floatright?o:-o}while(j<aq.top+aq.height){aq.top-=n;aq.left+=aq.floatright?o:-o}if(aq.floatright&&aq.floattop){ao.push(aq)}else{if(aq.floatright&&!aq.floattop){ai.push(aq)}else{if(!aq.floatright&&aq.floattop){aj.push(aq)}else{ah.push(aq)}}}}var ap=0;var al=[];var ak=function(at){if(al.length>0){for(var ar=0,au;au=al[ar];ar++){while(an(au,at)&&ap<1000){at.top+=at.floattop?n:-n;at.left+=at.floatright?o:-o;ap++}}}al.push(at)};for(var am=aj.length-1;am>=0;am--){ak(aj[am])}al=[];for(var am=0;am<ah.length;am++){ak(ah[am])}al=[];for(var am=0;am<ao.length;am++){ak(ao[am])}al=[];for(var am=ai.length-1;am>=0;am--){ak(ai[am])}};var ag=function(ai,ah){var i=ai;w.ctx.save();w.ctx.transform(R,0,0,P,0,0);if(!ah){w.DrawFigures.createQuadraticCurve(i.startX,i.startY,i.startX*0.8+i.endX()*0.2,i.startY*0.2+i.endY()*0.8,i.endX(),i.endY(),1,Z.bordercolor);if(Z.backcolor){w.DrawFigures.createRectangleFill(i.left,i.top,i.width,i.height,Z.backcolor)}var am=Z.fontsize||(i.length-1);var al=i.left+(i.floatright?o+(Z.withlegend?i.length+o:0):i.width-o);var ak=i.top+i.length/2+am/2+n/2;w.DrawFigures.createText(i.content,al,ak,i.floatright?"left":"right",null,am,Z.fontfamily,Z.color);if(Z.borderwidth&&Z.borderwidth>0){w.DrawFigures.createRectangleBorder(i.left,i.top,i.width,i.height,Z.borderwidth,Z.bordercolor)}}if(Z.withlegend){var aj=Z.legendtype||"s";var ah=ah||i.color;w.DrawFigures.createPointElement(aj,i.left+o,i.top+n,i.length,ah,aj!="x",ah,2,aj=="x")}w.ctx.restore()};if(af){if(af.contact){ag(af.contact,ac)}}else{ad();w.coordinates.nestedpie[u].outerlabels.length=0;for(var ab=0,ae;ae=z.outerlabels[ab];ab++){ag(ae);w.coordinates.nestedpie[u].outerlabels[ab]={left:ae.left,top:ae.top,width:ae.width,height:ae.height}}}};var h=function(al,ax){var ag=S;var aB=ag;var am=t.animation&&t.animateScale?al:1;var ap=t.animation&&t.animateRotate?al:1;var an=ax>=1;var aj=[];for(var at=0,az;az=p[at];at++){var Z=(az.value/X)*100;var au=ap*(Z/100*(Math.PI*2));var aq=az.color||K[at%K.length];var aa=ag;var ac=ag+w._formatSegmentAngle(au);var ak=(aa+ac)/2;if(an){az.percent=Z;w.coordinates.nestedpie[u].cemicircles.push({indexX:at,indexY:null,percent:Z,radius:F,angleMin:aa,angleMax:ac,color:aq})}var aw=new v(at,null,Z,aq,aa,ac,ak,az);aj.push(aw);ag=ac;var aA=az.subitems;if(aA&&LChart.Methods.IsArray(aA)){for(var ar=0,ae;ae=aA[ar];ar++){var ao=(ae.value/X)*100;var ah=ap*(ao/100*(Math.PI*2));var af=aB;var ay=aB+w._formatSegmentAngle(ah);var av=(af+ay)/2;var ab=ae.color||az.subcolor||aq;if(an){ae.percent=ao;ae.subpercent=(ae.value/m[at])*100;w.coordinates.nestedpie[u].cemicircles.push({indexX:at,indexY:ar,percent:ao,innerRadius:F,outerRadius:r,angleMin:af,angleMax:ay,color:ab})}var ad=new v(at,ar,Z,ab,af,ay,av,ae);ad.superShape=aw;aj.push(ad);aB=ay}}else{aB=ag}}faces=w._get3DFaceDrawOrder(aj,O,M);for(var at=0,ai;ai=faces[at];at++){H(ai.shape.isInnerPie,ai.type,am,ai.shape.angleMin,ai.shape.angleMax,ai.shape.color,false,ai.shape.data.darksidecolor,an&&ai.type==3?ai.shape.data:null,an&&ai.type==3?ai.shape:null)}if(an){z.cemicircles=aj;z.faces=faces;W();x()}};var E=function(){var Z=function(al,aj){var ad=null;for(var ag=0,ai;ai=z.cemicircles[ag];ag++){var ac=(ai.angleMin+ai.angleMax)/2;var af=LChart.Methods.GetCurrentAngle(al,aj,J.centerX,J.centerY);var ah=Math.pow(al-J.centerX,2)+Math.pow(aj-J.centerY,2);var aa=(ai.isInnerPie&&ah<=Math.pow(F,2)||!ai.isInnerPie&&ah>Math.pow(F,2)&&ah<=Math.pow(r,2))&&LChart.Methods.JudgeBetweenAngle(ai.angleMin,ai.angleMax,af);var an=false;if(t.outerLabel&&t.outerLabel.show&&ai.contact){var ak=ai.contact;if(al>=ak.left&&al<=ak.left+ak.width&&aj>=ak.top&&aj<=ak.top+ak.height){an=true}}if(aa||an){ad=ai;break}}if(!ad){for(var ag=z.cemicircles.length-1;ag>=0;ag--){var ai=z.cemicircles[ag];var ae=ai.computeinfo();var ah=Math.pow(al-ae.darkCenterX,2)+Math.pow(aj-ae.darkCenterY,2);var ab=LChart.Methods.GetCurrentAngle(al,aj,ae.darkCenterX,ae.darkCenterY);var am=(ai.isInnerPie&&ah<=Math.pow(F,2)||!ai.isInnerPie&&ah>Math.pow(F,2)&&ah<=Math.pow(r,2))&&LChart.Methods.JudgeBetweenAngle(ai.angleMin,ai.angleMax,ab);if(am){ad=ai;break}}}return ad};var j=function(ac){var ac=window.event||ac;var aa=LChart.Methods.tranferLocation(w._getMouseLoction(ac),R,P);var ab=Z(aa.X,aa.Y);if(ab){ab.click(ac)}};var i=function(ag){var ag=window.event||ag;var aa=LChart.Methods.tranferLocation(w._getMouseLoction(ag),R,P);var af=Z(aa.X,aa.Y);if(af){w._configs.cursorPointer=true}if(Y.currentMouseShape!=af){var ab=Y.currentMouseShape;
if(ab){ab.mouseleave(ag)}if(Y.currentMouseShape){w.redrawAll()}Y.currentMouseShape=af;for(var ae=0,ab;ab=z.cemicircles[ae];ae++){if(ab.isHovered){ab.isHovered=false;if(ab.hideTip){ab.hideTip()}}}if(af){af.isHovered=true;var ad=t.mouseoverTransparency;var ac="rgba(255,255,255,"+(ad>0&&ad<1?ad:0.2)+")";af.redraw(ac);x(af,ac);if(af.showTip){af.showTip()}af.mouseover(ag)}}};w._addEventListener("click",j);w._addEventListener("mousemove",i)};var b=function(){for(var j=0,Z;Z=z.faces[j];j++){H(Z.shape.isInnerPie,Z.type,1,Z.shape.angleMin,Z.shape.angleMax,Z.shape.color,false,Z.shape.darksidecolor)}W();x()};return{drawSegments:h,mouseEvents:E,redraw:b}};