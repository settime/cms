if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.NestedPie={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:"rgba(255,255,255,0.3)"}}LChart.NestedPie=LChart.getCore().__extends({GraphType:"NestedPie"});LChart.NestedPie._spreadSkin=function(b,a){b.separateLine={};b.innerLabel={};b.outerLabel={};b.separateLine.color=a.SeparateLineColor||null;b.innerLabel.color=a.InnerLabelColor||null;b.outerLabel.color=a.OuterLabelColor||null;b.outerLabel.bordercolor=a.OuterLabelBorderColor||null;b.outerLabel.backcolor=a.OuterLabelBackColor||null};LChart.NestedPie._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{offX:0,offY:0,innerRadius:null,outerRadius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,subitems:{outerlabalpoint:null,innerlabalpoint:null,inheritevents:true,showinnerlabels:false},separateLine:{color:null,width:null},innerLabel:{show:true,content:function(c){return c.percent.toFixed(1)+"%"},distance:null,color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(c){return c.text+" "+c.percent.toFixed(1)+"%"},withlegend:true,legendtype:null,length:null,color:null,backcolor:"rgba(255,255,255,0.3)",bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return a};LChart.NestedPie._getCheckOptions=function(){return{__top:[["offX","n"],["offY","n"],["innerRadius","n"],["outerRadius","n"],["margin","n"],["colors","ca"],["animateRotate","b"],["animateScale","b"],["startAngle","n"]],subitems:[["outerlabalpoint","n"],["innerlabalpoint","n"],["inheritevents","b"],["showinnerlabels","b"]],separateLine:[["color","c"],["width","n"]],innerLabel:[["show","b"],["content","f"],["distance","n"],["color","c"],["fontsize","n"],["fontfamily","s"]],outerLabel:[["show","b"],["content","f"],["withlegend","b"],["legendtype","s"],["length","n"],["backcolor","c"],["bordercolor","c"],["borderwidth","n"],["color","c"],["fontsize","n"],["fontfamily","s"]]}};LChart.NestedPie._drawgraphic=function(t,s,n,r){var E=t._computeRadiusForPies(r);var p=!r.outerRadius||!LChart.Methods.IsNumber(r.outerRadius)?E.maxRadius:r.outerRadius;var C=r.innerRadius&&r.innerRadius>p*0.1&&r.innerRadius<p?r.innerRadius:p*0.7;if(p<=C){throw new Error(t._messages.WrongSet+t._messages.OuterRadiusShouldBigger)}var z=s==t.ID;var G=(r.colors&&r.colors.length>0?r.colors:null)||LChart.Const.Defaults.FillColors;if(z){t.coordinates.draw=E.coordinate;t._configs.legendColors=G}if(!t.coordinates.nestedpie){t.coordinates.nestedpie={}}t.coordinates.nestedpie[s]={outerRadius:p,innerRadius:C,centerX:E.centerX,centerY:E.centerY,cemicircles:[],outerlabels:[]};t.shapes[s]={cemicircles:[],outerlabels:[]};var x=t.shapes[s];var M=0;var k=[];var c=[];var o=[];for(var L=0,w;w=n[L];L++){var g=w.value;if(typeof g!="number"||g<0){throw new Error(t._messages.WrongData+"'"+g+"'"+t._messages.DataMustGreaterThanZero)}M+=g;k[L]=g;var h=w.subitems;if(LChart.Methods.IsArray(h)){c[L]=true;var e=0;for(var K=0,q;q=h[K];K++){var a=q.value;o.push(a);if(typeof a!="number"||a<0){throw new Error(t._messages.WrongData+"'"+a+"'"+t._messages.DataMustGreaterThanZero)}e+=a}if(!(Math.abs(e-g)<0.00001)){throw new Error(t._messages.WrongData+"'"+g+"'"+t._messages.SubItemsValueShouldEqualSuperValue)}}else{c[L]=false}}var m=3;var l=3;var d=true;var O=t._configs.specificConfig[s];var D=r.subitems.outerlabalpoint;var I=r.subitems.innerlabalpoint;if(D==null||I==null){if(o.length>8){o.sort(function(i,j){return j-i});var A=o[8];if(D==null){D=A}if(I==null){I=A}}}var J=r.subitems.inheritevents;var H=r.subitems.showinnerlabels;var u=function(P,j,i,R,Q){this.indexX=P;this.indexY=j;this.angleMin=i;this.angleMax=R;this.data=Q;this.isHovered=false;this.isInnerPie=function(){return this.indexY==null};this.color=function(){return this.data.color||(this.isInnerPie()?G[this.indexX%G.length]:this.superShape.data.subcolor||this.superShape.color())};this.redraw=function(S){F(1,!this.isInnerPie(),this.angleMin,this.angleMax,S||this.color())};this.contact=null;this.superShape=null;this.click=function(U,T){var S=typeof this.data.click=="function"?this.data.click:(r.click||null);if(S){S(T||this.data,U)}else{if(J&&this.superShape){this.superShape.click(U,this.data)}}};this.mouseover=function(U,T){var S=typeof this.data.mouseover=="function"?this.data.mouseover:(r.mouseover||null);if(S){S(T||this.data,U)}else{if(J&&this.superShape){this.superShape.mouseover(U,this.data)}}};this.mouseleave=function(U,T){var S=typeof this.data.mouseleave=="function"?this.data.mouseleave:(r.mouseleave||null);if(S){S(T||this.data,U)}else{if(J&&this.superShape){this.superShape.mouseleave(U,this.data)}}};if(r.tip.show&&typeof r.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var V=(this.angleMin+this.angleMax)/2;
var W=this.isInnerPie()?C:(p+C);var U=E.centerX+W/2*Math.cos(V);var T=E.centerY+W/2*Math.sin(V);this.tip=t._createTip(r.tip.content(this.data),U,T);var S=this;S.tip.onclick=function(X){S.click(X)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var y=function(T,S,R,P,j,Q,U,i){this.content=T;this.length=S;this.width=R;this.height=P;this.floatright=j;this.floattop=Q;this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2};this.data=U;this.contact=i;this.color=function(){return this.contact.color()};this.resetposition=function(){var ac=i.isInnerPie()?C:p;var W=this.length;var aa=E.centerX;var Z=E.centerY;var X=(this.contact.angleMin+this.contact.angleMax)/2;var ab=Math.cos(X);var Y=Math.sin(X);var V=1.15;var ad=Y>0?Y:0;this.startX=aa+ac*ab;this.startY=Z+ac*Y;this.left=aa+p*V*ab+(this.floatright?0:-this.width);this.top=Z+p*V*Y+ad*W-W-l}};var F=function(aj,ag,P,R,ae,ai,Z){var W=(P+R)/2;var V=E.centerX;var U=E.centerY;var aa=Math.cos(W);var T=Math.sin(W);var ac=r.separateLine.width||1;var ah=r.separateLine.color;if(ag){t.DrawFigures.createRing(V,U,C*aj,p*aj,ae,P,R,ac,ah)}else{t.DrawFigures.createArc(V,U,C*aj,ac,ah,ae,P,R,true)}var j=r.outerLabel;if(ai&&j.show&&typeof j.content=="function"&&(ag&&(D==null||ai.value>D)||!c[ai.indexX])){var S=j.length||p/12;var X=LChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,W);var af=LChart.Methods.JudgeBetweenAngle(-Math.PI,0,W);var ad=j.content(ai);var Q=t.DrawFigures.measureText(ad,null,j.fontsize||(S-1),j.fontfamily);var ab=Q+(j.withlegend?S+3*m:2*m);var Y=S+l*2;var i=new y(ad,S,ab,Y,X?1:0,af?1:0,ai,Z);x.outerlabels.push(i);Z.contact=i}};var N=function(S){var R=r.innerLabel;if(!(R.show&&typeof R.content=="function")){return}var T=R.distance||0.5;var Q=function(V){var i=V.isInnerPie();var U=!V.isInnerPie()&&H&&(I==null||V.data.value>I);if(i||U){var aa=(V.angleMin+V.angleMax)/2;var X=V.data;var W=i?(C+p)/2*T:C+(p-C)*T;var Z=E.centerX+W*Math.cos(aa);var Y=E.centerY+W*Math.sin(aa);t.DrawFigures.createText(R.content(X),Z,Y,"center",X.fontweight,X.fontsize||R.fontsize||p/10,R.fontfamily,X.fontcolor||R.color||LChart.Const.Defaults.InnerLabelColor)}};if(S){Q(S)}else{for(var P=0,j;j=x.cemicircles[P];P++){Q(j)}}};var v=function(V,S){var P=r.outerLabel;if(!(P.show&&typeof P.content=="function")){return}var Q=z?E.coordinate.minY:5;var j=z?E.coordinate.maxY:t.canvas.height-5;if(d){for(var R=0,U;U=x.outerlabels[R];R++){U.resetposition()}d=false}var T=function(){var ad=function(ah,i){return Math.max(ah.left,i.left)<=Math.min(ah.left+ah.width,i.left+i.width)&&Math.max(ah.top,i.top)<=Math.min(ah.top+ah.height,i.top+i.height)};var Z=[];var X=[];var ae=[];var Y=[];for(var ac=0,ag;ag=x.outerlabels[ac];ac++){while(Q>ag.top){ag.top+=l;ag.left+=ag.floatright?m:-m}while(j<ag.top+ag.height){ag.top-=l;ag.left+=ag.floatright?m:-m}if(ag.floatright&&ag.floattop){ae.push(ag)}else{if(ag.floatright&&!ag.floattop){Y.push(ag)}else{if(!ag.floatright&&ag.floattop){Z.push(ag)}else{X.push(ag)}}}}var af=0;var ab=[];var aa=function(ai){if(ab.length>0){for(var ah=0,aj;aj=ab[ah];ah++){while(ad(aj,ai)&&af<1000){ai.top+=ai.floattop?l:-l;ai.left+=ai.floatright?m:-m;af++}}}ab.push(ai)};for(var ac=Z.length-1;ac>=0;ac--){aa(Z[ac])}ab=[];for(var ac=0;ac<X.length;ac++){aa(X[ac])}ab=[];for(var ac=0;ac<ae.length;ac++){aa(ae[ac])}ab=[];for(var ac=Y.length-1;ac>=0;ac--){aa(Y[ac])}};var W=function(Y,X){var i=Y;if(!X){t.DrawFigures.createQuadraticCurve(i.startX,i.startY,i.startX*0.8+i.endX()*0.2,i.startY*0.2+i.endY()*0.8,i.endX(),i.endY(),1,P.bordercolor);if(P.backcolor){t.DrawFigures.createRectangleFill(i.left,i.top,i.width,i.height,P.backcolor)}var ac=P.fontsize||(i.length-1);var ab=i.left+(i.floatright?m+(P.withlegend?i.length+m:0):i.width-m);var aa=i.top+i.length/2+ac/2+l/2;t.DrawFigures.createText(i.content,ab,aa,i.floatright?"left":"right",null,ac,P.fontfamily,P.color);if(P.borderwidth&&P.borderwidth>0){t.DrawFigures.createRectangleBorder(i.left,i.top,i.width,i.height,P.borderwidth,P.bordercolor)}}if(P.withlegend){var Z=P.legendtype||"s";var X=X||i.color();t.DrawFigures.createPointElement(Z,i.left+m,i.top+l,i.length,X,Z!="x",X,2,Z=="x")}};if(V){if(V.contact){W(V.contact,S)}}else{T();t.coordinates.nestedpie[s].outerlabels.length=0;for(var R=0,U;U=x.outerlabels[R];R++){W(U);t.coordinates.nestedpie[s].outerlabels[R]={left:U.left,top:U.top,width:U.width,height:U.height}}}};var b=function(){for(var P=0,j;j=x.cemicircles[P];P++){j.redraw()}N();v()};var f=function(V,ae){var U=Math.PI*(r.startAngle==null?-0.5:r.startAngle);var ai=U;var X=r.animation&&r.animateScale?V:1;var Y=r.animation&&r.animateRotate?V:1;for(var ac=0,ag;ag=n[ac];ac++){var P=(ag.value/M)*100;var ah=Y*(P/100*(Math.PI*2));var aa=ag.color||G[ac%G.length];var R=U+t._formatSegmentAngle(ah);var ad=null;if(ae>=1){ag.indexX=ac;ag.indexY=null;ag.percent=P;ad=new u(ac,null,U,R,ag);x.cemicircles.push(ad);F(X,null,U,R,aa,ag,ad);t.coordinates.nestedpie[s].cemicircles.push({indexX:ac,indexY:null,percent:P,radius:C,angleMin:U,angleMax:R,color:aa})
}else{F(X,null,U,R,aa)}U=R;var aj=ag.subitems;if(aj&&LChart.Methods.IsArray(aj)){for(var ab=0,T;T=aj[ab];ab++){var Z=(T.value/M)*100;var W=Y*(Z/100*(Math.PI*2));var af=ai+t._formatSegmentAngle(W);var Q=T.color||ag.subcolor||aa;if(ae>=1){T.indexX=ac;T.indexY=ab;T.percent=Z;T.subpercent=(T.value/k[ac])*100;var S=new u(ac,ab,ai,af,T);S.superShape=ad;x.cemicircles.push(S);F(X,true,ai,af,Q,T,S);t.coordinates.nestedpie[s].cemicircles.push({indexX:ac,indexY:ab,percent:Z,innerRadius:C,outerRadius:p,angleMin:ai,angleMax:af,color:Q})}else{F(X,true,ai,af,Q)}ai=af}}else{ai=U}}if(ae>=1){N();v()}};var B=function(){var P=function(Z,X){var T=null;for(var V=0,W;W=x.cemicircles[V];V++){var S=(W.angleMin+W.angleMax)/2;var U=LChart.Methods.GetCurrentAngle(Z,X,E.centerX,E.centerY);var Q=Math.pow(Z-E.centerX,2)+Math.pow(X-E.centerY,2);var R=(W.isInnerPie()&&Q<=Math.pow(C,2)||!W.isInnerPie()&&Q>Math.pow(C,2)&&Q<=Math.pow(p,2))&&LChart.Methods.JudgeBetweenAngle(W.angleMin,W.angleMax,U);var aa=false;if(r.outerLabel&&r.outerLabel.show&&W.contact){var Y=W.contact;if(Z>=Y.left&&Z<=Y.left+Y.width&&X>=Y.top&&X<=Y.top+Y.height){aa=true}}if(R||aa){T=W;break}}return T};var j=function(S){var S=window.event||S;var Q=t._getMouseLoction(S);var R=P(Q.X,Q.Y);if(R){R.click(S)}};var i=function(W){var W=window.event||W;var Q=t._getMouseLoction(W);var V=P(Q.X,Q.Y);if(V){t._configs.cursorPointer=true}if(O.currentMouseShape!=V){var R=O.currentMouseShape;if(R){R.mouseleave(W)}if(O.currentMouseShape){t.redrawAll()}O.currentMouseShape=V;for(var U=0,R;R=x.cemicircles[U];U++){if(R.isHovered){R.isHovered=false;if(R.hideTip){R.hideTip()}}}if(V){V.isHovered=true;var T=r.mouseoverTransparency;var S="rgba(255,255,255,"+(T>0&&T<1?T:0.2)+")";V.redraw(S);v(V,S);if(V.showTip){V.showTip()}V.mouseover(W)}}};t._addEventListener("click",j);t._addEventListener("mousemove",i)};return{drawSegments:f,mouseEvents:B,redraw:b}};