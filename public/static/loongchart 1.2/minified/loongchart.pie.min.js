if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.Pie={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:"rgba(255,255,255,0.3)"}}LChart.Pie=LChart.getCore().__extends({GraphType:"Pie"});LChart.Pie._spreadSkin=function(b,a){b.separateLine={};b.innerLabel={};b.outerLabel={};b.separateLine.color=a.SeparateLineColor||null;b.innerLabel.color=a.InnerLabelColor||null;b.outerLabel.color=a.OuterLabelColor||null;b.outerLabel.bordercolor=a.OuterLabelBorderColor||null;b.outerLabel.backcolor=a.OuterLabelBackColor||null};LChart.Pie._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{offX:0,offY:0,radius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,clickout:true,separateLine:{show:false,color:null,width:null},innerLabel:{show:true,content:function(c){return c.percent.toFixed(1)+"%"},distance:null,color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(c){return c.text+" "+c.percent.toFixed(1)+"%"},withlegend:true,legendtype:null,length:null,color:null,backcolor:"rgba(255,255,255,0.3)",bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return a};LChart.Pie._getCheckOptions=function(){return{__top:[["offX","n"],["offY","n"],["radius","n"],["margin","n"],["colors","ca"],["animateRotate","b"],["animateScale","b"],["startAngle","n"],["clickout","b"]],separateLine:[["show","b"],["color","c"],["width","n"]],innerLabel:[["show","b"],["content","f"],["distance","n"],["color","c"],["fontsize","n"],["fontfamily","s"]],outerLabel:[["show","b"],["content","f"],["withlegend","b"],["legendtype","s"],["length","n"],["backcolor","c"],["bordercolor","c"],["borderwidth","n"],["color","c"],["fontsize","n"],["fontfamily","s"]]}};LChart.Pie._drawgraphic=function(v,i,r,d){var a=v._computeSegmentTotal(r).segmentTotal;var u=v._computeRadiusForPies(d);var k=!d.radius||!LChart.Methods.IsNumber(d.radius)?u.maxRadius:d.radius;var q=k/10;var g=i==v.ID;var j=(d.colors&&d.colors.length>0?d.colors:null)||LChart.Const.Defaults.FillColors;if(g){v.coordinates.draw=u.coordinate;v._configs.legendColors=j}v.shapes[i]={cemicircles:[],outerLabels:[]};var n=v.shapes[i];if(!v.coordinates.pie){v.coordinates.pie={}}v.coordinates.pie[i]={radius:k,centerX:u.centerX,centerY:u.centerY,cemicircles:[],outerlabels:[]};var c=3;var b=3;var h=true;var w=v._configs.specificConfig[i];var m=function(y,x,A,z,B){this.index=y;this.angleMin=x;this.angleMax=A;this.data=z;this.isHovered=false;this.isClickout=B;this.color=function(){return this.data.color||j[this.index%j.length]};this.redraw=function(C,D){t(C,1,this.angleMin,this.angleMax,D||this.color())};this.contact=null;this.click=function(G,C){if(d.clickout){h=true;this.isClickout=!this.isClickout;v.redrawAll();var E=d.mouseoverTransparency;var D="rgba(255,255,255,"+(E>0&&E<1?E:0.2)+")";this.redraw(this.isClickout,D);p(this,D)}if(!d.clickout||this.isClickout){var F=typeof this.data.click=="function"?this.data.click:(d.click||null);if(F){F(this.data,G)}}};if(d.tip.show&&typeof d.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var F=(this.angleMin+this.angleMax)/2;var E=u.centerX+k*0.5*Math.cos(F);var D=u.centerY+k*0.5*Math.sin(F);this.tip=v._createTip(d.tip.content(this.data),E,D);var C=this;C.tip.onclick=function(G){C.click(G)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var e=function(D,C,B,z,y,A,E,x){this.content=D;this.length=C;this.width=B;this.height=z;this.floatright=y;this.floattop=A;this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2};this.data=E;this.contact=x;this.color=function(){return this.contact.color()};this.index=function(){return this.contact.index};this.resetposition=function(){var G=this.length;var L=u.centerX;var I=u.centerY;var K=(this.contact.angleMin+this.contact.angleMax)/2;var H=Math.cos(K);var F=Math.sin(K);if(this.contact.isClickout){L+=q*H;I+=q*F}var M=1.15;var J=F>0?F:0;this.startX=L+k*H;this.startY=I+k*F;this.left=L+k*M*H+(this.floatright?0:-this.width);this.top=I+k*M*F+J*G-G-b}};var t=function(z,S,A,C,O,R,K){var H=(A+C)/2;var G=u.centerX;var F=u.centerY;var L=Math.cos(H);var E=Math.sin(H);if(z){G+=q*L;F+=q*E}var P=d.separateLine.show?(d.separateLine.width||1):0;v.DrawFigures.createArc(G,F,k*S,P,d.separateLine.color,O,A,C,true);var y=d.outerLabel;if(R&&y.show&&typeof y.content=="function"){var D=y.length||k/12;var I=LChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,H);var Q=LChart.Methods.JudgeBetweenAngle(-Math.PI,0,H);var N=y.content(R);var B=v.DrawFigures.measureText(N,null,y.fontsize||(D-1),y.fontfamily);var M=B+(y.withlegend?D+3*c:2*c);var J=D+b*2;var x=new e(N,D,M,J,I?1:0,Q?1:0,R,K);n.outerLabels.push(x);K.contact=x}};var f=function(B){var A=d.innerLabel;
if(!(A.show&&typeof A.content=="function")){return}var C=A.distance||0.6;var z=function(D){var I=(D.angleMin+D.angleMax)/2;var F=D.data;var E=D.isClickout?(k*C+q):k*C;var H=u.centerX+E*Math.cos(I);var G=u.centerY+E*Math.sin(I);v.DrawFigures.createText(A.content(F),H,G,"center",F.fontweight,F.fontsize||A.fontsize||k/10,A.fontfamily,F.fontcolor||A.color||LChart.Const.Defaults.InnerLabelColor)};if(B){z(B)}else{for(var y=0,x;x=n.cemicircles[y];y++){z(x)}}};var p=function(E,B){var y=d.outerLabel;if(!(y.show&&typeof y.content=="function")){return}var z=g?u.coordinate.minY:5;var x=g?u.coordinate.maxY:v.canvas.height-5;if(h){for(var A=0,D;D=n.outerLabels[A];A++){D.resetposition()}h=false}var C=function(){var M=function(R,Q){return Math.max(R.left,Q.left)<=Math.min(R.left+R.width,Q.left+Q.width)&&Math.max(R.top,Q.top)<=Math.min(R.top+R.height,Q.top+Q.height)};var I=[];var G=[];var N=[];var H=[];for(var L=0,P;P=n.outerLabels[L];L++){while(z>P.top){P.top+=b;P.left+=P.floatright?c:-c}while(x<P.top+P.height){P.top-=b;P.left+=P.floatright?c:-c}if(P.floatright&&P.floattop){N.push(P)}else{if(P.floatright&&!P.floattop){H.push(P)}else{if(!P.floatright&&P.floattop){I.push(P)}else{G.push(P)}}}}var O=0;var K=[];var J=function(R){if(K.length>0){for(var Q=0,S;S=K[Q];Q++){while(M(S,R)&&O<1000){R.top+=R.floattop?b:-b;R.left+=R.floatright?c:-c;O++}}}K.push(R)};for(var L=I.length-1;L>=0;L--){J(I[L])}K=[];for(var L=0;L<G.length;L++){J(G[L])}K=[];for(var L=0;L<N.length;L++){J(N[L])}K=[];for(var L=H.length-1;L>=0;L--){J(H[L])}};var F=function(I,H){var G=I;if(!H){v.DrawFigures.createQuadraticCurve(G.startX,G.startY,G.startX*0.8+G.endX()*0.2,G.startY*0.2+G.endY()*0.8,G.endX(),G.endY(),1,y.bordercolor);if(y.backcolor){v.DrawFigures.createRectangleFill(G.left,G.top,G.width,G.height,y.backcolor)}var M=y.fontsize||(G.length-1);var L=G.left+(G.floatright?c+(y.withlegend?G.length+c:0):G.width-c);var K=G.top+G.length/2+M/2+b/2;v.DrawFigures.createText(G.content,L,K,G.floatright?"left":"right",null,M,y.fontfamily,y.color);if(y.borderwidth&&y.borderwidth>0){v.DrawFigures.createRectangleBorder(G.left,G.top,G.width,G.height,y.borderwidth,y.bordercolor)}}if(y.withlegend){var J=y.legendtype||"s";var H=H||G.color();v.DrawFigures.createPointElement(J,G.left+c,G.top+b,G.length,H,J!="x",H,2,J=="x")}};if(E){F(E.contact,B)}else{C();v.coordinates.pie[i].outerlabels.length=0;for(var A=0,D;D=n.outerLabels[A];A++){F(D);v.coordinates.pie[i].outerlabels[A]={index:D.contact.index,left:D.left,top:D.top,width:D.width,height:D.height}}}};var s=function(){for(var y=0,x;x=n.cemicircles[y];y++){x.redraw(x.isClickout)}f();p()};var o=function(x,A){var E=Math.PI*(d.startAngle==null?-0.5:d.startAngle);var D=d.animation&&d.animateScale?x:1;var G=d.animation&&d.animateRotate?x:1;for(var B=0,I;I=r[B];B++){var F=(I.value/a)*100;var y=G*(F/100*(Math.PI*2));var z=I.color||j[B%j.length];var H=E+v._formatSegmentAngle(y);if(A>=1){I.index=B;I.percent=F;var C=new m(B,E,H,I,I.extended==true);n.cemicircles.push(C);t(I.extended,D,E,H,z,I,C);v.coordinates.pie[i].cemicircles.push({index:B,percent:F,angleMin:E,angleMax:H,color:z})}else{t(I.extended,D,E,H,z)}E=H}if(A>=1){f();p()}};var l=function(){var z=function(M,K){var C=null;for(var G=0,I;I=n.cemicircles[G];G++){var B=(I.angleMin+I.angleMax)/2;var J=q*Math.cos(B);var H=q*Math.sin(B);var F=u.centerX+(I.isClickout?J:0);var E=u.centerY+(I.isClickout?H:0);var D=LChart.Methods.GetCurrentAngle(M,K,F,E);var A=(Math.pow(M-F,2)+Math.pow(K-E,2)<=Math.pow(k,2))&&LChart.Methods.JudgeBetweenAngle(I.angleMin,I.angleMax,D);var N=false;if(d.outerLabel&&d.outerLabel.show&&I.contact){var L=I.contact;if(M>=L.left&&M<=L.left+L.width&&K>=L.top&&K<=L.top+L.height){N=true}}if(A||N){C=I;break}}return C};var y=function(C){var C=window.event||C;var A=v._getMouseLoction(C);var B=z(A.X,A.Y);if(B){B.click(C)}};var x=function(E){var E=window.event||E;var H=v._getMouseLoction(E);var C=z(H.X,H.Y);if(C){v._configs.cursorPointer=true}if(w.currentMouseShape!=C){var F=w.currentMouseShape;if(F){var B=typeof F.data.mouseleave=="function"?F.data.mouseleave:(d.mouseleave||null);if(B){B(F.data,E)}}if(w.currentMouseShape){v.redrawAll()}w.currentMouseShape=C;for(var D=0,F;F=n.cemicircles[D];D++){if(F.isHovered){F.isHovered=false;if(F.hideTip){F.hideTip()}}}if(C){C.isHovered=true;var A=d.mouseoverTransparency;var G="rgba(255,255,255,"+(A>0&&A<1?A:0.2)+")";C.redraw(C.isClickout,G);p(C,G);if(C.showTip){C.showTip()}var I=typeof C.data.mouseover=="function"?C.data.mouseover:(d.mouseover||null);if(I){I(C.data,E)}}}};v._addEventListener("click",y);v._addEventListener("mousemove",x)};return{drawSegments:o,mouseEvents:l,redraw:s}};