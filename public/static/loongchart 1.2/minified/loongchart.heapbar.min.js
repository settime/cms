if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.HeapBar={CutLinecolor:null,InnerLabelColor:null}}LChart.HeapBar=LChart.getCore().__extends({GraphType:"HeapBar"});LChart.HeapBar._spreadSkin=function(b,a){b.bar={};b.label={};b.bar.cutlinecolor=a.CutLinecolor||null;b.label.color=a.InnerLabelColor||null};LChart.HeapBar._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{animateY:true,animateX:true,bar:{colors:null,length:null,cutlinecolor:null,cutlinewidth:null},label:{show:true,content:function(c){return this.valueType=="p"?c.percent.toFixed(1)+"%":c.value.toString()},color:null,fontweight:null,fontsize:null,fontfamily:null}});return a};LChart.HeapBar._getCheckOptions=function(){return{__top:[["animateY","b"],["animateX","b"]],bar:[["colors","ca"],["length","n"],["cutlinecolor","c"],["cutlinewidth","n"]],label:[["show","b"],["content","f"],["color","c"],["fontweight","s"],["fontsize","n"],["fontfamily","s"]]}};LChart.HeapBar._drawgraphic=function(s,j,n,f){if(f.valueType&&f.valueType!="n"&&f.valueType!="p"){throw new Error(s._messages.WrongParam+s._messages.ValueTypeMustBeNumberOrPercent)}if(!LChart.Methods.IsArray(n[0].value)){throw new Error(s._messages.WrongData+s._messages.DataMustBeMultipleArray)}if(j==s.ID){s._configs.invertAxis=true;s._configs.notAllowValueNegative=true}var h=s._formatAxisData(true);var c=s._calculateOutersValid();var r=s._computeAxis(c);var q=s._getDrawableCoordinate();var d=Math.floor(f.bar.cutlinewidth||0);var i=f.bar.cutlinecolor||"#ffffff";var a=d>0;var b=h.vValueType=="p";var g=f.bar.length;if(g&&g>0){var e=r.labelDistance*0.8;g=Math.min(g,e)}else{g=r.labelDistance*0.6}var k=(f.bar.colors&&f.bar.colors.length>0?f.bar.colors:null)||LChart.Const.Defaults.FillColors;if(j==s.ID){s.coordinates.draw=q;s._configs.legendColors=k}var u=s._configs.specificConfig[j];s.shapes[j]={bars:[]};if(!s.coordinates.bars){s.coordinates.bars={}}s.coordinates.bars[j]=[];var p=function(x,D,v,E,z,B,F){if(!F){s.DrawFigures.createRectangleFill(x,D,v,E,z)}if(B&&f.label.show){var w=f.label;var C=typeof w.content=="function"?w.content.call(f,B):"";if(C){var A=x+v/2;var G=w.fontsize||LChart.Methods.CapValue(v/2,18,11);var y=D+E/2+G/3;var z=w.color||"#ffffff";s.DrawFigures.createText(C,A,y,"center",B.fontweight||w.fontweight,B.fontsize||G,w.fontfamily,B.fontcolor||z)}}};var t=function(D,B,w,A,v,C,x,y,z){this.indexX=D;this.indexY=B;this.left=w;this.top=A;this.width=v;this.height=C;this.data=y;this.lineright=z;this.isHovered=false;this.color=x;this.redrawrect=function(E){p(this.left,this.top,this.width,this.height,E||this.color)};this.redrawtext=function(){p(this.left,this.top,this.width,this.height,x||this.color,this.data,true)};this.click=function(F){var E=typeof this.data.click=="function"?this.data.click:(f.click||null);if(E){E(this.data,F)}};if(f.tip.show&&typeof f.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var G=this.left+this.width*0.7+5;var F=this.top+this.height/2;this.tip=s._createTip(f.tip.content.call(f,this.data),G,F);if(G+this.tip.clientWidth>r.maxX){s._changeTip(this.tip,G-this.tip.clientWidth-this.width*0.5)}var E=this;E.tip.onclick=function(H){E.click(H)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var m=function(B,K){var x=function(Q){var P=(f.animateX?B:1)*(r.maxX-r.minX)*s._getFormatDiff(h.vValueType,h.vMinValue,Q)/s._getFormatDiff(h.vValueType,h.vMinValue,h.vMaxValue);return P};var D=(f.animateY?B:1)*g;for(var I=0;I<h.tuftCount;I++){var C=r.startPos-r.labelDistance*I-g/2;var J=0;var y=[];var A=[];for(var F=0;F<h.demanCount;F++){var L=n[F];var G=L.color||k[F%k.length];var w=b?L.percent:L.value;var O=w[I];if(O!=null){var E=x(O);var z=r.minX+J;J+=E;if(z+E>r.maxX-1){E-=z+E-r.maxX+1;z=r.maxX-1-E}if(F>0){z+=d/2}if(F==h.demanCount-1||F==0){E-=d/2}else{E-=d}if(z<r.minX){z=r.minX}var N=null;if(a&&F<h.demanCount-1){N=z+E+d/2;if(N-d/2-1<r.minX){N=r.minX+d/2+1}y.push(N)}if(K>=1){var M={click:L.click,mouseover:L.mouseover,mouseleave:L.mouseleave,label:h.lLabels[I],text:L.text,indexX:I,indexY:F,fontsize:L.fontsize,fontcolor:L.fontcolor,fontweight:L.fontweight};if(b){M.percent=O;M.value=L.value[I]}else{M.value=O}var v=new t(F,I,z,C,E,D,G,M,N);s.shapes[j].bars.push(v);A.push(v);v.redrawrect();if(!s.coordinates.bars[j][I]){s.coordinates.bars[j][I]=[]}s.coordinates.bars[j][I][F]={left:z,top:C,width:E,height:D,color:G}}else{p(z,C,E,D,G)}}}if(a){for(var H=0;H<y.length;H++){s.DrawFigures.createLine(y[H],C,y[H],C+D,d,i)}}if(K>=1){for(var H=0,v;v=A[H];H++){v.redrawtext()}}}};var l=function(){var x=function(z,D){var C=null;for(var B=0,A;A=s.shapes[j].bars[B];B++){if(A.left<=z&&A.left+A.width>=z&&A.top<=D&&A.top+A.height>=D){C=A;break}}return C};var w=function(A){var A=window.event||A;var y=s._getMouseLoction(A);var z=x(y.X,y.Y);if(z){z.click(A)}};var v=function(E){var E=window.event||E;
var A=s._getMouseLoction(E);var D=x(A.X,A.Y);if(D){s._configs.cursorPointer=true}if(u.currentMouseShape!=D){var B=u.currentMouseShape;if(B){B.isHovered=false;if(B.hideTip){B.hideTip()}var y=typeof B.data.mouseleave=="function"?B.data.mouseleave:(f.mouseleave||null);if(y){y(B.data,E)}}if(u.currentMouseShape){s.redrawAll()}u.currentMouseShape=D;if(D){D.isHovered=true;var C=f.mouseoverTransparency;D.redrawrect("rgba(255,255,255,"+(C>0&&C<1?C:0.2)+")");if(D.showTip){D.showTip()}var z=typeof D.data.mouseover=="function"?D.data.mouseover:(f.mouseover||null);if(z){z(D.data,E)}}}};s._addEventListener("click",w);s._addEventListener("mousemove",v)};var o=function(){for(var w=0,v;v=s.shapes[j].bars[w];w++){v.redrawrect()}for(var w=0,v;v=s.shapes[j].bars[w];w++){if(v.lineright!=null){s.DrawFigures.createLine(v.lineright,v.top,v.lineright,v.top+v.height,d,i)}}for(var w=0,v;v=s.shapes[j].bars[w];w++){v.redrawtext()}};return{drawSegments:m,mouseEvents:l,redraw:o}};