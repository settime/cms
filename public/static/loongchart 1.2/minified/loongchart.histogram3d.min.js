if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.Histogram3D={TopLabelColor:null}}LChart.Histogram3D=LChart.getCore().__extends({GraphType:"Histogram3D"});LChart.Histogram3D._spreadSkin=function(b,a){b.topLabel={};b.topLabel.color=a.TopLabelColor||null};LChart.Histogram3D._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{animateY:true,animateX:true,histogram:{colors:null,length:null,gap:null,useSameColor:true},topLabel:{show:true,content:function(c){if(this.valueType=="d"||this.valueType=="t"||this.valueType=="m"){return""}else{if(this.valueType=="p"){return c.percent.toFixed(1).toString()+"%"}else{return c.value.toString()}}},color:null,fontweight:null,fontsize:null,fontfamily:null}});return a};LChart.Histogram3D._getCheckOptions=function(){return{__top:[["animateY","b"],["animateX","b"]],histogram:[["colors","ca"],["length","n"],["gap","n"],["useSameColor","b"]],topLabel:[["show","b"],["content","f"],["color","c"],["fontweight","s"],["fontsize","n"],["fontfamily","s"]]}};LChart.Histogram3D._drawgraphic=function(x,k,p,e){x._configs.recreateAssists=true;if(k==x.ID){x._configs.notAllowValueNegative=true}var g=x._formatAxisData();var b=x._calculateOutersValid();var u=x._computeAxis(b);var t=x._getDrawableCoordinate();x.shapes[k]={histograms:[]};if(!x.coordinates.histograms){x.coordinates.histograms={}}x.coordinates.histograms[k]=[];var z=x._configs.specificConfig[k];var a=g.vValueType=="p";var c=e.shadow.show&&e.shadow.blur>0;var h=c?{color:e.shadow.color,blur:e.shadow.blur}:null;var f=e.histogram.length;var n=e.histogram.gap;if(g.multiple){if(n&&n>0){var y=(u.labelDistance-g.demanCount*2)/(g.demanCount+1);n=Math.min(n,y)}else{n=u.labelDistance/20}}if(f&&f>0){var d=g.multiple?((u.labelDistance-(g.demanCount+1)*n)/g.demanCount):u.labelDistance*0.8;f=Math.min(f,d)}else{f=(u.labelDistance-(g.demanCount+1)*n)/(g.multiple?(g.demanCount+0.5):1.5)}var w=function(B,A){if(A!=undefined){var C=g.demanCount/2-B;return u.startPos+u.labelDistance*A-C*f-(C-0.5)*n}else{return u.startPos+u.labelDistance*B-f/2}};var j=(e.histogram.colors&&e.histogram.colors.length>0?e.histogram.colors:null)||LChart.Const.Defaults.FillColors;if(k==x.ID){x.coordinates.draw=t;x._configs.legendColors=j;if(g.multiple){x._configs.pointsPosition={labelDistance:u.labelDistance,startPoints:[]};for(var s=0,v;v=p[s];s++){x._configs.pointsPosition[s]=w(s,0)+f/2}}}var r=function(J,E,H,D,i,B){var M=J.left-u.stagewidth*u.sinsightangle;var K=J.top+u.stagewidth*u.cossightangle;var G=E||J.color;if(i){x.DrawFigures.create3DHistogram(M,K,J.width,J.height,G,0,u.sightangle,u.stagewidth,null,H?E:J.topcolor||LChart.Methods.getDarkenColor(G,0.7),H?E:J.rightcolor||LChart.Methods.getDarkenColor(G,0.8),D)}if(B&&e.topLabel.show){var A=e.topLabel;var I=typeof A.content=="function"?A.content.call(e,J.data):"";if(I){var F=(J.left+M)/2+J.width/2;var L=A.fontsize||LChart.Methods.CapValue(J.width/2,18,11);var C=(J.top+K)/2+L/3;x.DrawFigures.createText(I,F,C,"center",J.data.fontweight||A.fontweight,J.data.fontsize||L,A.fontfamily,J.data.fontcolor||A.color)}}};var m=function(I,G,C,F,A,H,D,i,B,E){this.indexX=I;this.indexY=G;this.left=C;this.top=F;this.width=A;this.height=H;this.data=E;this.isHovered=false;this.color=D;this.topcolor=i;this.rightcolor=B;this.redraw=function(N,K,M,J){var L=h;if(c&&J){L=LChart.Methods.DeepCopy(h);L.color=J}r(this,J,N,L,K,M)};this.click=function(K){var J=typeof this.data.click=="function"?this.data.click:(e.click||null);if(J){J(this.data,K)}};if(e.tip.show&&typeof e.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var L=this.left;var K=this.top+this.height/2;this.tip=x._createTip(e.tip.content.call(e,this.data),L,K);if(L+this.tip.clientWidth>u.maxX){x._changeTip(this.tip,L-this.tip.clientWidth)}var J=this;J.tip.onclick=function(M){J.click(M)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var o=function(A,G){var J=function(Q){var i=(e.animateY?A:1)*(u.maxY-u.minY)*x._getFormatDiff(g.vValueType,g.vMinValue,Q)/x._getFormatDiff(g.vValueType,g.vMinValue,g.vMaxValue);return i};var C=G>=1;var N=[];for(var I=0,P;P=p[I];I++){var B=(e.animateX?A:1)*f;if(g.multiple){var F=P.color||j[I%j.length];var M=a?P.percent:P.value;for(var E=0;E<M.length;E++){if(P.value[E]!=null){var D=w(I,E);var O=J(M[E]);var L=u.maxY-O;var H=null;if(C){H={indexX:E,indexY:I,label:g.lLabels[E],click:P.click,mouseover:P.mouseover,mouseleave:P.mouseleave,text:P.text,fontsize:P.fontsize,fontcolor:P.fontcolor,fontweight:P.fontweight};if(a){H.percent=M[E];H.value=P.value[E]}else{H.value=M[E]}if(!x.coordinates.histograms[k][E]){x.coordinates.histograms[k][E]=[]}x.coordinates.histograms[k][E][I]={left:D,top:L,width:B,height:O,color:F}}var K=new m(E,I,D,L,B,O,F,P.topcolor,P.rightcolor,H);N.push(K)}}}else{if(P.value!=null){var D=w(I);var O=J(a?P.percent:P.value);
var L=u.maxY-O;var F=P.color||(e.histogram.useSameColor?"rgba(69,114,167,1)":j[I%j.length]);if(C){P.indexX=I;P.indexY=null;x.coordinates.histograms[k][I]={left:D,top:L,width:B,height:O,color:F}}var K=new m(null,I,D,L,B,O,F,P.topcolor,P.rightcolor,C?P:null);N.push(K)}}}if(g.multiple){N.sort(function(Q,i){if(Q.indexX==i.indexX){return Q.indexY-i.indexY}else{return Q.indexX-i.indexX}})}for(var I=0,K;K=N[I];I++){r(K,K.color,false,h,true)}if(C){for(var I=0,K;K=N[I];I++){r(K,K.color,false,h,false,true)}x.shapes[k].histograms=N}};var l=function(){var B=function(K,J){var D=null;var F=u.cossightangle*u.stagewidth;var C=u.sinsightangle*u.stagewidth;for(var E=0,G;G=x.shapes[k].histograms[E];E++){var M=G.left-u.stagewidth*u.sinsightangle;var L=G.top+u.stagewidth*u.cossightangle;if(M<=K&&M+G.width>=K&&L<=J&&L+G.height>=J){D=G;break}}if(!D){for(var E=0,G;G=x.shapes[k].histograms[E];E++){if(G.top<=J&&G.top+F>=J){var I=G.left-C*(J-G.top)/F;if(I<=K&&I+G.width>=K){D=G;break}}}}if(!D){for(var E=0,G;G=x.shapes[k].histograms[E];E++){if(G.left+G.width-C<=K&&G.left+G.width>=K){var H=G.top+F*(G.left+G.width-K)/C;if(H<=J&&H+G.height>=J){D=G;break}}}}return D};var A=function(E){var E=window.event||E;var C=x._getMouseLoction(E);var D=B(C.X,C.Y);if(D){D.click(E)}};var i=function(J){var J=window.event||J;var E=x._getMouseLoction(J);var I=B(E.X,E.Y);if(I){x._configs.cursorPointer=true}if(z.currentMouseShape!=I){var F=z.currentMouseShape;if(F){var C=typeof F.data.mouseleave=="function"?F.data.mouseleave:(e.mouseleave||null);if(C){C(F.data,J)}}if(c||z.currentMouseShape||e.topLabel.show){x.redrawAll()}z.currentMouseShape=I;for(var H=0,F;F=x.shapes[k].histograms[H];H++){if(F!=I&&F.isHovered){F.isHovered=false;if(F.hideTip){F.hideTip()}}}if(I){I.isHovered=true;var G=e.mouseoverTransparency;I.redraw(true,true,false,"rgba(255,255,255,"+(G>0&&G<1?G:0.2)+")");if(I.showTip){I.showTip()}var D=typeof I.data.mouseover=="function"?I.data.mouseover:(e.mouseover||null);if(D){D(I.data,J)}}}};x._addEventListener("click",A);x._addEventListener("mousemove",i)};var q=function(){for(var B=0,A;A=x.shapes[k].histograms[B];B++){A.redraw(false,true)}for(var B=0,A;A=x.shapes[k].histograms[B];B++){A.redraw(false,false,true)}};return{drawSegments:o,mouseEvents:l,redraw:q}};