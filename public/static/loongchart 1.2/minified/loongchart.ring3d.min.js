if(!window.LChart){throw new Error("未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n"+"Not loaded loongchart.core.js which must be loaded before other LChart's js.")}else{LChart.Const.Skins.BlackAndWhite.Ring3D={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:"rgba(255,255,255,0.3)"}}LChart.Ring3D=LChart.getCore().__extends({GraphType:"Ring3D"});LChart.Ring3D._spreadSkin=function(b,a){b.separateLine={};b.innerLabel={};b.outerLabel={};b.separateLine.color=a.SeparateLineColor||null;b.innerLabel.color=a.InnerLabelColor||null;b.outerLabel.color=a.OuterLabelColor||null;b.outerLabel.bordercolor=a.OuterLabelBorderColor||null;b.outerLabel.backcolor=a.OuterLabelBackColor||null};LChart.Ring3D._getDefaultOptions=function(b){var a=LChart.Methods.Extend(b,{offX:0,offY:0,innerRadius:null,outerRadius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,clickout:true,reflection3d:{reflectoffX:null,reflectoffY:null,zoomX:null,zoomY:null},separateLine:{show:false,color:null,width:null},innerLabel:{show:true,content:function(c){return c.percent.toFixed(1)+"%"},distance:null,color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(c){return c.text+" "+c.percent.toFixed(1)+"%"},withlegend:true,legendtype:null,length:null,color:null,backcolor:"rgba(255,255,255,0.3)",bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return a};LChart.Ring3D._getCheckOptions=function(){return{__top:[["offX","n"],["offY","n"],["innerRadius","n"],["outerRadius","n"],["margin","n"],["colors","ca"],["animateRotate","b"],["animateScale","b"],["startAngle","n"],["clickout","b"]],reflection3d:[["reflectoffX","n"],["reflectoffY","n"],["zoomX","n"],["zoomY","n"]],separateLine:[["show","b"],["color","c"],["width","n"]],innerLabel:[["show","b"],["content","f"],["distance","n"],["color","c"],["fontsize","n"],["fontfamily","s"]],outerLabel:[["show","b"],["content","f"],["withlegend","b"],["legendtype","s"],["length","n"],["backcolor","c"],["bordercolor","c"],["borderwidth","n"],["color","c"],["fontsize","n"],["fontfamily","s"]]}};LChart.Ring3D._drawgraphic=function(F,m,y,g){var d=F._computeSegmentTotal(y).segmentTotal;var f=3;var e=3;var p=g.reflection3d.zoomX||1.2;var n=g.reflection3d.zoomY||0.9;if(F._configs._isIE678.isIE678){p=1;n=1}var D=F._computeRadiusForPies(g,p,n);if(F._configs._isIE678.isIE678){D.maxRadius*=0.9}var a=!g.outerRadius||!LChart.Methods.IsNumber(g.outerRadius)?D.maxRadius:g.outerRadius;var h=g.innerRadius&&g.innerRadius>a*0.1&&g.innerRadius<a?g.innerRadius:a*0.7;if(a<=h){throw new Error(F._messages.WrongSet+F._messages.OuterRadiusShouldBigger)}var x=a/10;var k=m==F.ID;var o=(g.colors&&g.colors.length>0?g.colors:null)||LChart.Const.Defaults.FillColors;if(k){F.coordinates.draw=D.coordinate;F._configs.legendColors=o}F.shapes[m]={cemicircles:[],outerLabels:[],faces:null};var u=F.shapes[m];if(!F.coordinates.ring){F.coordinates.ring={}}F.coordinates.ring[m]={outerRadius:a,innerRadius:h,centerX:D.centerX,centerY:D.centerY,cemicircles:[],outerlabels:[]};var t=g.reflection3d.reflectoffX||0;var r=g.reflection3d.reflectoffY||a/6;var l=true;var H=F._configs.specificConfig[m];var B=g.separateLine.show?(g.separateLine.width||1):0;var C=g.separateLine.color||"#ffffff";var G=Math.PI*(g.startAngle==null?-0.5:g.startAngle);var c=F._getReflectAngle(t,r);var b=function(V,P,N,U){var I=(N+U)/2;var L=D.centerX;var K=D.centerY;var O=Math.cos(I);var J=Math.sin(I);if(V){L+=x*O;K+=x*J}var Q=h*P;var M=a*P;var S=L+t;var R=K+r;var T=function(Z,X,aa){var W=Z==0?L:(Z==1?K:(Z==2?S:R));var Y=Z==0||Z==2?Math.cos:Math.sin;return W+Y(X?U:N)*(aa?M:Q)};return{angleMin:N,angleMax:U,midAngle:I,centerX:L,centerY:K,darkCenterX:S,darkCenterY:R,innerRadius:Q,outerRadius:M,iStartX:T(0,0,0),iStartY:T(1,0,0),iEndX:T(0,1,0),iEndY:T(1,1,0),oStartX:T(0,0,1),oStartY:T(1,0,1),oEndX:T(0,1,1),oEndY:T(1,1,1),d_iStartX:T(2,0,0),d_iStartY:T(3,0,0),d_iEndX:T(2,1,0),d_iEndY:T(3,1,0),d_oStartX:T(2,0,1),d_oStartY:T(3,0,1),d_oEndX:T(2,1,1),d_oEndY:T(3,1,1)}};var E=function(I){return LChart.Methods.computeDifferAngle(I,c*Math.PI)<Math.PI/2};var i=function(O,N,M,K,J,L,P,I){this.content=O;this.length=N;this.width=M;this.height=K;this.floatright=J;this.floattop=L;this.data=P;this.contact=I;this.color=this.contact.color;this.index=this.contact.index;this.resetposition=function(){var R=this.contact.computeinfo(),Q=E(R.midAngle);var V=1.15,T=Math.cos(R.midAngle),S=Math.sin(R.midAngle),U=S>0?S:0;this.startX=(Q?(R.centerX+R.darkCenterX)/2:R.centerX)+a*T;this.startY=(Q?(R.centerY+R.darkCenterY)/2:R.centerY)+a*S;this.left=(Q?R.darkCenterX:R.centerX)+a*V*T+(this.floatright?0:-this.width);this.top=(Q?R.darkCenterY:R.centerY)+a*V*S+U*this.length-this.length-e};this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2}};var s=function(K,J,L,I,O,N,M,P){this.index=K;this.color=J;this.percent=L;this.angleMin=I;this.angleMax=O;
this.midAngle=N;this.isHovered=false;this.isClickout=P;this.data=M;this.redraw=function(Q,R){var T=R;for(var S=0;S<4;S++){A(S,Q,1,this.angleMin,this.angleMax,R||this.color,T,T?R:this.data.darksidecolor)}};this.contact=null;this.computeinfo=function(Q){if(!this._computeinfo||Q){this._computeinfo=b(this.isClickout,1,this.angleMin,this.angleMax)}return this._computeinfo};this.click=function(U,Q){if(g.clickout){l=true;this.isClickout=!this.isClickout;this.computeinfo(true);F.redrawAll();var S=g.mouseoverTransparency;var R="rgba(255,255,255,"+(S>0&&S<1?S:0.2)+")";this.redraw(this.isClickout,R);w(this,R)}if(!g.clickout||this.isClickout){var T=typeof this.data.click=="function"?this.data.click:(g.click||null);if(T){T(this.data,U)}}};if(g.tip.show&&typeof g.tip.content=="function"){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display="inline"}else{var T=(this.angleMin+this.angleMax)/2;var S=D.centerX+(a+h)/2*Math.cos(T);var R=D.centerY+(a+h)/2*Math.sin(T);this.tip=F._createTip(g.tip.content(this.data),S*p,R*n);var Q=this;Q.tip.onclick=function(U){Q.click(U)}}};this.hideTip=function(){if(this.tip){this.tip.style.display="none"}}}};var A=function(I,L,ac,M,P,Z,Y,S,ab,V){var R=b(L,ac,M,P);S=S||LChart.Methods.getDarkenColor(Z);var O=Y?0:B;F.ctx.save();F.ctx.transform(p,0,0,n,0,0);switch(I){case 0:F.DrawFigures.createRingReflection(R,S);break;case 1:F.DrawFigures.createCloseFigure([[R.iEndX,R.iEndY],[R.d_iEndX,R.d_iEndY],[R.d_oEndX,R.d_oEndY],[R.oEndX,R.oEndY]],S);break;case 2:F.DrawFigures.createCloseFigure([[R.iStartX,R.iStartY],[R.d_iStartX,R.d_iStartY],[R.d_oStartX,R.d_oStartY],[R.oStartX,R.oStartY]],S);break;default:F.DrawFigures.createRing(R.centerX,R.centerY,R.innerRadius,R.outerRadius,Z,M,P,O,C);if(O>0){if(E(M)){F.DrawFigures.createLine(R.oStartX,R.oStartY,R.d_oStartX,R.d_oStartY,O,C)}else{F.DrawFigures.createLine(R.iStartX,R.iStartY,R.d_iStartX,R.d_iStartY,O,C)}if(L){if(E(P)){F.DrawFigures.createLine(R.oEndX,R.oEndY,R.d_oEndX,R.d_oEndY,O,C)}else{F.DrawFigures.createLine(R.iEndX,R.iEndY,R.d_iEndX,R.d_iEndY,O,C)}}}break}F.ctx.restore();var K=g.outerLabel;if(ab&&K.show&&typeof K.content=="function"){var Q=K.length||a/12;var T=LChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,R.midAngle);var aa=LChart.Methods.JudgeBetweenAngle(-Math.PI,0,R.midAngle);var X=K.content(ab);var N=F.DrawFigures.measureText(X,null,K.fontsize||(Q-1),K.fontfamily);var W=N+(K.withlegend?Q+3*f:2*f);var U=Q+e*2;var J=new i(X,Q,W,U,T?1:0,aa?1:0,ab,V);u.outerLabels.push(J);V.contact=J}};var j=function(M){var L=g.innerLabel;if(!(L.show&&typeof L.content=="function")){return}var N=(L.distance||0.5);var K=function(O){var T=(O.angleMin+O.angleMax)/2;var Q=O.data;var P=h+(a-h)*N+(O.isClickout?x:0);var S=D.centerX+P*Math.cos(T);var R=D.centerY+P*Math.sin(T);F.ctx.save();F.ctx.transform(p,0,0,n,0,0);F.DrawFigures.createText(L.content(Q),S,R,"center",Q.fontweight,Q.fontsize||L.fontsize||a/10,L.fontfamily,Q.fontcolor||L.color||LChart.Const.Defaults.InnerLabelColor);F.ctx.restore()};if(M){K(M)}else{for(var J=0,I;I=u.cemicircles[J];J++){K(I)}}};var w=function(P,M){var J=g.outerLabel;if(!(J.show&&typeof J.content=="function")){return}var K=(k?D.coordinate.minY:5)/n;var I=(k?D.coordinate.maxY:F.canvas.height-5)/n;u.outerLabels.sort(function(S,R){return S.index-R.index});if(l){for(var L=0,O;O=u.outerLabels[L];L++){O.resetposition()}l=false}var N=function(){var X=function(ac,ab){return Math.max(ac.left,ab.left)<=Math.min(ac.left+ac.width,ab.left+ab.width)&&Math.max(ac.top,ab.top)<=Math.min(ac.top+ac.height,ab.top+ab.height)};var T=[];var R=[];var Y=[];var S=[];for(var W=0,aa;aa=u.outerLabels[W];W++){while(K>aa.top){aa.top+=e;aa.left+=aa.floatright?f:-f}while(I<aa.top+aa.height){aa.top-=e;aa.left+=aa.floatright?f:-f}if(aa.floatright&&aa.floattop){Y.push(aa)}else{if(aa.floatright&&!aa.floattop){S.push(aa)}else{if(!aa.floatright&&aa.floattop){T.push(aa)}else{R.push(aa)}}}}var Z=0;var V=[];var U=function(ac){if(V.length>0){for(var ab=0,ad;ad=V[ab];ab++){while(X(ad,ac)&&Z<1000){ac.top+=ac.floattop?e:-e;ac.left+=ac.floatright?f:-f;Z++}}}V.push(ac)};for(var W=T.length-1;W>=0;W--){U(T[W])}V=[];for(var W=0;W<R.length;W++){U(R[W])}V=[];for(var W=0;W<Y.length;W++){U(Y[W])}V=[];for(var W=S.length-1;W>=0;W--){U(S[W])}};var Q=function(T,S){var R=T;F.ctx.save();F.ctx.transform(p,0,0,n,0,0);if(!S){F.DrawFigures.createQuadraticCurve(R.startX,R.startY,R.startX*0.8+R.endX()*0.2,R.startY*0.2+R.endY()*0.8,R.endX(),R.endY(),1,J.bordercolor);if(J.backcolor){F.DrawFigures.createRectangleFill(R.left,R.top,R.width,R.height,J.backcolor)}var X=J.fontsize||(R.length-1);var W=R.left+(R.floatright?f+(J.withlegend?R.length+f:0):R.width-f);var V=R.top+R.length/2+X/2+e/2;F.DrawFigures.createText(R.content,W,V,R.floatright?"left":"right",null,X,J.fontfamily,J.color);if(J.borderwidth&&J.borderwidth>0){F.DrawFigures.createRectangleBorder(R.left,R.top,R.width,R.height,J.borderwidth,J.bordercolor)}}if(J.withlegend){var U=J.legendtype||"s";var S=S||R.color;F.DrawFigures.createPointElement(U,R.left+f,R.top+e,R.length,S,U!="x",S,2,U=="x")
}F.ctx.restore()};if(P){Q(P.contact,M)}else{N();F.coordinates.ring[m].outerlabels.length=0;for(var L=0,O;O=u.outerLabels[L];L++){Q(O);F.coordinates.ring[m].outerlabels[L]={index:O.contact.index,left:O.left,top:O.top,width:O.width,height:O.height}}}};var v=function(I,N){var Q=g.animation&&g.animateScale?I:1;var W=g.animation&&g.animateRotate?I:1;var J=N>=1;var U=[];var S=G;for(var O=0,Y;Y=y[O];O++){var T=(Y.value/d)*100;var M=T/100*Math.PI*2*W;var L=Y.color||o[O%o.length];var R=S;var X=S+F._formatSegmentAngle(M);var K=(R+X)/2;if(J){Y.percent=T;F.coordinates.ring[m].cemicircles.push({index:O,percent:T,angleMin:R,angleMax:X,color:L})}var P=new s(O,L,T,R,X,K,Y,Y.extended);U.push(P);S+=M}faces=F._get3DFaceDrawOrder(U,t,r);for(var O=0,V;V=faces[O];O++){A(V.type,V.shape.data.extended,Q,V.shape.angleMin,V.shape.angleMax,V.shape.color,false,V.shape.data.darksidecolor,J&&V.type==3?V.shape.data:null,J&&V.type==3?V.shape:null)}if(J){u.cemicircles=U;u.faces=faces;j();w()}};var q=function(){var K=function(V,T){var N=null;for(var Q=0,S;S=u.cemicircles[Q];Q++){var P=S.computeinfo();var O=LChart.Methods.GetCurrentAngle(V,T,P.centerX,P.centerY);var R=Math.pow(V-P.centerX,2)+Math.pow(T-P.centerY,2);var L=R>=Math.pow(h,2)&&R<=Math.pow(a,2)&&LChart.Methods.JudgeBetweenAngle(S.angleMin,S.angleMax,O);var X=false;if(g.outerLabel&&g.outerLabel.show&&S.contact){var U=S.contact;if(V>=U.left&&V<=U.left+U.width&&T>=U.top&&T<=U.top+U.height){X=true}}if(L||X){N=S;break}}if(!N){for(var Q=u.cemicircles.length-1;Q>=0;Q--){var S=u.cemicircles[Q];var P=S.computeinfo();var R=Math.pow(V-P.darkCenterX,2)+Math.pow(T-P.darkCenterY,2);var M=LChart.Methods.GetCurrentAngle(V,T,P.darkCenterX,P.darkCenterY);var W=R>=Math.pow(h,2)&&R<=Math.pow(a,2)&&LChart.Methods.JudgeBetweenAngle(S.angleMin,S.angleMax,M);if(W){N=S;break}}}return N};var J=function(N){var N=window.event||N;var L=LChart.Methods.tranferLocation(F._getMouseLoction(N),p,n);var M=K(L.X,L.Y);if(M){M.click(N)}};var I=function(P){var P=window.event||P;var S=LChart.Methods.tranferLocation(F._getMouseLoction(P),p,n);var N=K(S.X,S.Y);if(N){F._configs.cursorPointer=true}if(H.currentMouseShape!=N){var Q=H.currentMouseShape;if(Q){var M=typeof Q.data.mouseleave=="function"?Q.data.mouseleave:(g.mouseleave||null);if(M){M(Q.data,P)}}if(H.currentMouseShape){F.redrawAll()}H.currentMouseShape=N;for(var O=0,Q;Q=u.cemicircles[O];O++){if(Q.isHovered){Q.isHovered=false;if(Q.hideTip){Q.hideTip()}}}if(N){N.isHovered=true;var L=g.mouseoverTransparency;var R="rgba(255,255,255,"+(L>0&&L<1?L:0.2)+")";N.redraw(N.isClickout,R);w(N,R);if(N.showTip){N.showTip()}var T=typeof N.data.mouseover=="function"?N.data.mouseover:(g.mouseover||null);if(T){T(N.data,P)}}}};F._addEventListener("click",J);F._addEventListener("mousemove",I)};var z=function(){for(var I=0,J;J=u.faces[I];I++){A(J.type,J.shape.isClickout,1,J.shape.angleMin,J.shape.angleMax,J.shape.color,null,J.shape.data.darksidecolor)}j();w()};return{drawSegments:v,mouseEvents:q,redraw:z}};